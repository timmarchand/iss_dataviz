<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.26">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Space – ISS Data Visualiation and Analysis</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../example/13-example.html" rel="next">
<link href="../example/11-example.html" rel="prev">
<link href="..//files/favicon-512.png" rel="icon" type="image/png">
<script src="../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-1b3db88def35042d172274863c1cdcf0.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-39e54efe698d158150328aebe0ca31b1.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/quarto-contrib/fontawesome6-0.1.0/all.css" rel="stylesheet">
<link href="../site_libs/quarto-contrib/fontawesome6-0.1.0/latex-fontsize.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="nav-sidebar docked nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">ISS Data Visualiation and Analysis</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../syllabus.html"> 
<span class="menu-text">Syllabus</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../schedule.html"> 
<span class="menu-text">Schedule</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../content/index.html"> 
<span class="menu-text">Content</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../lesson/index.html"> 
<span class="menu-text">Lessons</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../assignment/index.html"> 
<span class="menu-text">Assignments</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../resource/index.html"> 
<span class="menu-text">Resources</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../news/index.html"> 
<span class="menu-text">News</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://discord.com/"> <i class="bi bi-discord" role="img" aria-label="Discord">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://posit.cloud"> <i class="bi bi-cloud-fill" role="img" aria-label="Posit.cloud">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../example/10-example.html">Special applications</a></li><li class="breadcrumb-item"><a href="../example/12-example.html">12: Space</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Overview</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../example/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Code examples</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Foundations</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../example/01-example.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">1: Introduction to R and the tidyverse</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../example/02-example.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">2: Graphic design</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../example/03-example.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">3: Mapping data to graphics</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Core types of graphics</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../example/04-example.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">4: Amounts and proportions</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../example/05-example.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">5: Themes</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../example/06-example.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">6: Uncertainty</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../example/07-example.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">7: Relationships</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../example/08-example.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">8: Comparisons</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../example/09-example.qmd" class="sidebar-item-text sidebar-link">
 <span class="menu-text">9: Annotations</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text">Special applications</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../example/10-example.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">10: Enhancing graphics</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../example/11-example.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">11: Interactivity</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../example/12-example.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">12: Space</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../example/13-example.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">13: Time</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../example/14-example.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">14: Text</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../example/15-example.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">15: Truth, beauty, and data revisited</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#shapefiles" id="toc-shapefiles" class="nav-link active" data-scroll-target="#shapefiles">Shapefiles</a></li>
  <li><a href="#projections-and-coordinate-reference-systems" id="toc-projections-and-coordinate-reference-systems" class="nav-link" data-scroll-target="#projections-and-coordinate-reference-systems">Projections and coordinate reference systems</a></li>
  <li><a href="#shapefiles-to-download" id="toc-shapefiles-to-download" class="nav-link" data-scroll-target="#shapefiles-to-download">Shapefiles to download</a></li>
  <li><a href="#live-coding-example" id="toc-live-coding-example" class="nav-link" data-scroll-target="#live-coding-example">Live coding example</a></li>
  <li><a href="#load-and-look-at-data" id="toc-load-and-look-at-data" class="nav-link" data-scroll-target="#load-and-look-at-data">Load and look at data</a></li>
  <li><a href="#basic-plotting" id="toc-basic-plotting" class="nav-link" data-scroll-target="#basic-plotting">Basic plotting</a></li>
  <li><a href="#world-map-with-different-projections" id="toc-world-map-with-different-projections" class="nav-link" data-scroll-target="#world-map-with-different-projections">World map with different projections</a></li>
  <li><a href="#us-map-with-different-projections" id="toc-us-map-with-different-projections" class="nav-link" data-scroll-target="#us-map-with-different-projections">US map with different projections</a></li>
  <li><a href="#us-map-with-non-continguous-parts" id="toc-us-map-with-non-continguous-parts" class="nav-link" data-scroll-target="#us-map-with-non-continguous-parts">US map with non-continguous parts</a></li>
  <li><a href="#individual-states" id="toc-individual-states" class="nav-link" data-scroll-target="#individual-states">Individual states</a></li>
  <li><a href="#plotting-multiple-shapefile-layers" id="toc-plotting-multiple-shapefile-layers" class="nav-link" data-scroll-target="#plotting-multiple-shapefile-layers">Plotting multiple shapefile layers</a></li>
  <li><a href="#plotting-multiple-shapefile-layers-when-some-are-bigger-than-the-parent-shape" id="toc-plotting-multiple-shapefile-layers-when-some-are-bigger-than-the-parent-shape" class="nav-link" data-scroll-target="#plotting-multiple-shapefile-layers-when-some-are-bigger-than-the-parent-shape">Plotting multiple shapefile layers when some are bigger than the parent shape</a></li>
  <li><a href="#plotting-schools-in-georgia" id="toc-plotting-schools-in-georgia" class="nav-link" data-scroll-target="#plotting-schools-in-georgia">Plotting schools in Georgia</a></li>
  <li><a href="#making-your-own-geocoded-data" id="toc-making-your-own-geocoded-data" class="nav-link" data-scroll-target="#making-your-own-geocoded-data">Making your own geocoded data</a></li>
  <li><a href="#automatic-geocoding-by-address" id="toc-automatic-geocoding-by-address" class="nav-link" data-scroll-target="#automatic-geocoding-by-address">Automatic geocoding by address</a></li>
  <li><a href="#plotting-other-data-on-maps" id="toc-plotting-other-data-on-maps" class="nav-link" data-scroll-target="#plotting-other-data-on-maps">Plotting other data on maps</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../example/10-example.html">Special applications</a></li><li class="breadcrumb-item"><a href="../example/12-example.html">12: Space</a></li></ol></nav>
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">Space</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
</div>



<div class="quarto-title-meta">

    
      <div class="date-block bg-example text-white p-2">
    <!-- <div class="quarto-title-meta-heading">Published</div> -->
    <div class="quarto-title-meta-contents">
      <p class="date">Example for Monday, April 6, 2026–Friday, April 10, 2026</p>
    </div>
  </div>
    
    
  </div>
  


</header>


<section id="shapefiles" class="level2">
<h2 class="anchored" data-anchor-id="shapefiles">Shapefiles</h2>
<p>Shapefiles are special types of data that include information about geography, such as points (latitude, longitude), paths (a bunch of connected latitudes and longitudes) and areas (a bunch of connected latitudes and longitudes that form a complete shape). Nowadays, most government agencies provide shapefiles for their jurisdictions. For global mapping data, you can use the Natural Earth project:</p>
<ul>
<li><a href="https://www.naturalearthdata.com/">Natural Earth</a></li>
<li><a href="https://www.census.gov/geographies/mapping-files/time-series/geo/cartographic-boundary.html">US Census Bureau</a></li>
<li><a href="https://data.georgiaspatial.org/">Georgia GIS Clearinghouse</a> (requires a free account; the interface is <em>incredibly</em> clunky)</li>
<li><a href="https://opendata.atlantaregional.com/">Atlanta Regional Council</a></li>
<li><a href="https://gisdata.fultoncountyga.gov/">Fulton County GIS Portal</a></li>
<li><a href="https://dcp-coaplangis.opendata.arcgis.com/">City of Atlanta, Department of City Planning</a></li>
</ul>
</section>
<section id="projections-and-coordinate-reference-systems" class="level2">
<h2 class="anchored" data-anchor-id="projections-and-coordinate-reference-systems">Projections and coordinate reference systems</h2>
<p>As you read in this week’s readings, projections matter a lot for maps. You can convert your geographic data between different coordinate systems (or projections) fairly easily with {sf}. You can use <code>coord_sf(crs = st_crs("XXXX"))</code> to convert coordinate reference systems (CRS) as you plot, or use <code>st_transform()</code> to convert data frames to a different CRS.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Not 100% correct
</div>
</div>
<div class="callout-body-container callout-body">
<p>TECHNICALLY coordinate systems and projection systems <a href="https://gis.stackexchange.com/a/149751/56265">are different things</a>, but I’m not a geographer and I don’t care that much about the nuance.</p>
</div>
</div>
<p>There are standard indexes of more than 4,000 of these projections (!!!) at <a href="https://epsg.io/">epsg.io</a>.</p>
<p><strong>Super important</strong>: When using these projections, you need to specify both the projection catalog (ESRI or EPSG; <a href="https://gis.stackexchange.com/a/169211/56265">see here for the difference</a>) and the projection number, separated by a colon (e.g.&nbsp;“<code>ESRI:54030</code>”). Fortunately <a href="http://epsg.io/">epsg.io</a> makes this super easy: go to the epsg.io page for the projection you want to use and the page title will have the correct name.</p>
<p>Here are some common ones:</p>
<ul>
<li><a href="http://epsg.io/54002">ESRI:54002</a>: Equidistant cylindrical projection for the world<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a></li>
<li><a href="http://epsg.io/3395">EPSG:3395</a>: Mercator projection for the world</li>
<li><a href="http://epsg.io/54008">ESRI:54008</a>: Sinusoidal projection for the world</li>
<li><a href="http://epsg.io/54009">ESRI:54009</a>: Mollweide projection for the world</li>
<li><a href="http://epsg.io/54030">ESRI:54030</a>: Robinson projection for the world (This is my favorite world projection.)</li>
<li><a href="http://epsg.io/4326">EPSG:4326</a>: WGS 84: DOD GPS coordinates (standard −180 to 180 system)</li>
<li><a href="http://epsg.io/4269">EPSG:4269</a>: NAD 83: Relatively common projection for North America</li>
<li><a href="https://epsg.io/102003">ESRI:102003</a>: Albers projection specifically for the contiguous United States</li>
</ul>
<p>Alternatively, instead of using these index numbers, you can use any of the names listed <a href="https://proj.org/operations/projections/index.html">here</a>, such as:</p>
<ul>
<li><code>"+proj=merc"</code>: Mercator</li>
<li><code>"+proj=robin"</code>: Robinson</li>
<li><code>"+proj=moll"</code>: Mollweide</li>
<li><code>"+proj=aeqd"</code>: Azimuthal Equidistant</li>
<li><code>"+proj=cass"</code>: Cassini-Soldner</li>
</ul>
</section>
<section id="shapefiles-to-download" class="level2">
<h2 class="anchored" data-anchor-id="shapefiles-to-download">Shapefiles to download</h2>
<p>I use a lot of different shapefiles in this example. To save you from having to go find and download each individual one, you can download this zip file:</p>
<ul>
<li><a href="../files/data/external_data/shapefiles.zip"><i class="fa-solid fa-file-archive" aria-label="file-archive"></i> <code>shapefiles.zip</code></a></li>
</ul>
<p>Unzip this and put all the contained folders in a folder named <code>data</code> if you want to follow along. <strong>You don’t need to follow along!</strong></p>
<p>Your project should be structured like this:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>your-project-name\</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>  some-name.qmd</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>  your-project-name.Rproj</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>  data\</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    cb_2022_us_county_5m\</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>      ...</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>      cb_2022_us_county_5m.shp</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>      ...</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>    cb_2022_us_state_20m\</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>    ne_10m_admin_1_states_provinces\</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>    ne_10m_lakes\</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>    ne_10m_rivers_lake_centerlines\</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    ne_10m_rivers_north_america\</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>    ne_110m_admin_0_countries\</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>    schools_2009\</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>These shapefiles all came from these sources:</p>
<ul>
<li><i class="fa-solid fa-map" aria-label="map"></i> <strong>World map</strong>: <a href="https://www.naturalearthdata.com/downloads/110m-cultural-vectors/">110m “Admin 0 - Countries” from Natural Earth</a></li>
<li><i class="fa-solid fa-map" aria-label="map"></i> <strong>US states</strong>: <a href="https://www.census.gov/geographies/mapping-files/time-series/geo/cartographic-boundary.html">20m 2022 state boundaries from the US Census Bureau</a></li>
<li><i class="fa-solid fa-map" aria-label="map"></i> <strong>US counties</strong>: <a href="https://www.census.gov/geographies/mapping-files/time-series/geo/cartographic-boundary.html">5m 2022 county boundaries from the US Census Bureau</a></li>
<li><i class="fa-solid fa-map" aria-label="map"></i> <strong>US states high resolution</strong>: <a href="https://www.naturalearthdata.com/downloads/10m-cultural-vectors/">10m “Admin 1 – States, Provinces” from Natural Earth</a></li>
<li><i class="fa-solid fa-map" aria-label="map"></i> <strong>Global rivers</strong>: <a href="https://www.naturalearthdata.com/downloads/10m-cultural-vectors/">10m “Rivers + lake centerlines” from Natural Earth</a></li>
<li><i class="fa-solid fa-map" aria-label="map"></i> <strong>North American rivers</strong>: <a href="https://www.naturalearthdata.com/downloads/10m-physical-vectors/">10m “Rivers + lake centerlines, North America supplement” from Natural Earth</a></li>
<li><i class="fa-solid fa-map" aria-label="map"></i> <strong>Global lakes</strong>: <a href="https://www.naturalearthdata.com/downloads/10m-physical-vectors/">10m “Lakes + Reservoirs” from Natural Earth</a></li>
<li><i class="fa-solid fa-map" aria-label="map"></i> <strong>Georgia K–12 schools, 2009</strong>: <a href="https://data.georgiaspatial.org/index.asp?body=preview&amp;dataId=41516">“Georgia K-12 Schools” from the Georgia Department of Education</a> <em>(you must be logged in to access this)</em></li>
</ul>
</section>
<section id="live-coding-example" class="level2">
<h2 class="anchored" data-anchor-id="live-coding-example">Live coding example</h2>
<div class="ratio ratio-16x9">
<iframe src="https://www.youtube.com/embed/Opzwtegvuv4" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen="" frameborder="0">
</iframe>
</div>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Important</span>Slight differences from the video
</div>
</div>
<div class="callout-body-container callout-body">
<p>This is a slightly cleaned up version of the code from the video.</p>
</div>
</div>
</section>
<section id="load-and-look-at-data" class="level2">
<h2 class="anchored" data-anchor-id="load-and-look-at-data">Load and look at data</h2>
<p>First we’ll load the libraries we’re going to use:</p>
<div class="cell" data-layout-align="center">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)  <span class="co"># For ggplot, dplyr, and friends</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)         <span class="co"># For GIS magic</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<p>Next we’ll load all the different shapefiles we downloaded using <code>read_sf()</code>:</p>
<div class="cell" data-layout-align="center">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Download "Admin 0 – Countries" from</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="co"># https://www.naturalearthdata.com/downloads/110m-cultural-vectors/</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>world_map <span class="ot">&lt;-</span> <span class="fu">read_sf</span>(<span class="st">"data/ne_110m_admin_0_countries/ne_110m_admin_0_countries.shp"</span>)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Download cb_2022_us_state_20m.zip under "States" from</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="co"># https://www.census.gov/geographies/mapping-files/time-series/geo/cartographic-boundary.html</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>us_states <span class="ot">&lt;-</span> <span class="fu">read_sf</span>(<span class="st">"data/cb_2022_us_state_20m/cb_2022_us_state_20m.shp"</span>)</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Download cb_2022_us_county_5m.zip under "County" from</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a><span class="co"># https://www.census.gov/geographies/mapping-files/time-series/geo/cartographic-boundary.html</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>us_counties <span class="ot">&lt;-</span> <span class="fu">read_sf</span>(<span class="st">"data/cb_2022_us_county_5m/cb_2022_us_county_5m.shp"</span>)</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Download "Admin 1 – States, Provinces" from</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a><span class="co"># https://www.naturalearthdata.com/downloads/10m-cultural-vectors/</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>us_states_hires <span class="ot">&lt;-</span> <span class="fu">read_sf</span>(<span class="st">"data/ne_10m_admin_1_states_provinces/ne_10m_admin_1_states_provinces.shp"</span>)</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Download "Rivers + lake centerlines" from</span></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a><span class="co"># https://www.naturalearthdata.com/downloads/10m-physical-vectors/</span></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>rivers_global <span class="ot">&lt;-</span> <span class="fu">read_sf</span>(<span class="st">"data/ne_10m_rivers_lake_centerlines/ne_10m_rivers_lake_centerlines.shp"</span>)</span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Download "Rivers + lake centerlines, North America supplement" from</span></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a><span class="co"># https://www.naturalearthdata.com/downloads/10m-physical-vectors/</span></span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>rivers_na <span class="ot">&lt;-</span> <span class="fu">read_sf</span>(<span class="st">"data/ne_10m_rivers_north_america/ne_10m_rivers_north_america.shp"</span>)</span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Download "Lakes + Reservoirs" from</span></span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a><span class="co"># https://www.naturalearthdata.com/downloads/10m-physical-vectors/</span></span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>lakes <span class="ot">&lt;-</span> <span class="fu">read_sf</span>(<span class="st">"data/ne_10m_lakes/ne_10m_lakes.shp"</span>)</span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Download from https://data.georgiaspatial.org/index.asp?body=preview&amp;dataId=41516</span></span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a><span class="co"># after creating an account and logging in</span></span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a>ga_schools <span class="ot">&lt;-</span> <span class="fu">read_sf</span>(<span class="st">"data/schools_2009/DOE Schools 2009.shp"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
</section>
<section id="basic-plotting" class="level2">
<h2 class="anchored" data-anchor-id="basic-plotting">Basic plotting</h2>
<p>If you look at the <code>world_map</code> dataset in RStudio, you’ll see it’s just a standard data frame with 177 rows and 169 columns. The last column is the magical <code>geometry</code> column with the latitude/longitude details for the borders for every country. RStudio only shows you 50 columns at a time in the RStudio viewer, so you’ll need to move to the next page of columns with the » button in the top left corner.</p>
<p>Because this is just a data frame, we can do all our normal dplyr things to it. Let’s get rid of Antarctica, since it takes up a big proportion of the southern hemisphere:</p>
<div class="cell" data-layout-align="center">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>world_sans_antarctica <span class="ot">&lt;-</span> world_map <span class="sc">|&gt;</span> </span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(ISO_A3 <span class="sc">!=</span> <span class="st">"ATA"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<p>Ready to plot a map? Here’s all you need to do:</p>
<div class="cell" data-layout-align="center">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> world_sans_antarctica)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="12-example_files/figure-html/map-super-basic-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
<p>If you couldn’t tell from the lecture, I’m completely blown away by how amazingly easy this every time I plot a map :)</p>
<p>Because this a regular ggplot geom, all our regular aesthetics and themes and everything work:</p>
<div class="cell" data-layout-align="center">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> world_sans_antarctica, </span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">fill =</span> <span class="st">"#669438"</span>, <span class="at">color =</span> <span class="st">"#32481B"</span>, <span class="at">linewidth =</span> <span class="fl">0.25</span>) <span class="sc">+</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="12-example_files/figure-html/map-super-basic-filled-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
<p>The Natural Earth dataset happens to come with some columns with a coloring scheme with 7–13 colors (<code>MAPCOLOR7</code>, <code>MAPCOLOR9</code>, etc.) so that no countries with a shared border share a color. We can fill by that column:</p>
<div class="cell" data-layout-align="center">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> world_sans_antarctica, </span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>          <span class="fu">aes</span>(<span class="at">fill =</span> <span class="fu">as.factor</span>(MAPCOLOR7)),</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">color =</span> <span class="st">"#401D16"</span>, <span class="at">linewidth =</span> <span class="fl">0.25</span>) <span class="sc">+</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_d</span>(<span class="at">option =</span> <span class="st">"plasma"</span>) <span class="sc">+</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">fill =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="12-example_files/figure-html/map-super-basic-filled-7-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="world-map-with-different-projections" class="level2">
<h2 class="anchored" data-anchor-id="world-map-with-different-projections">World map with different projections</h2>
<p>Changing projections is trivial: add a <code>coord_sf()</code> layer where you specify the CRS you want to use.</p>
<p>Here’s Robinson (yay):</p>
<div class="cell" data-layout-align="center">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> world_sans_antarctica, </span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">fill =</span> <span class="st">"#669438"</span>, <span class="at">color =</span> <span class="st">"#32481B"</span>, <span class="at">linewidth =</span> <span class="fl">0.25</span>) <span class="sc">+</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf</span>(<span class="at">crs =</span> <span class="fu">st_crs</span>(<span class="st">"ESRI:54030"</span>)) <span class="sc">+</span>  <span class="co"># Robinson</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Or use the name instead of the number</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># coord_sf(crs = "+proj=robin")</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="12-example_files/figure-html/map-basic-robinson-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
<p>Here’s sinusoidal:</p>
<div class="cell" data-layout-align="center">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> world_sans_antarctica, </span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">fill =</span> <span class="st">"#669438"</span>, <span class="at">color =</span> <span class="st">"#32481B"</span>, <span class="at">linewidth =</span> <span class="fl">0.25</span>) <span class="sc">+</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf</span>(<span class="at">crs =</span> <span class="fu">st_crs</span>(<span class="st">"ESRI:54008"</span>)) <span class="sc">+</span>  <span class="co"># Sinusoidal</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="12-example_files/figure-html/map-basic-sinusoidal-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
<p>And here’s Mercator (ewww):</p>
<div class="cell" data-layout-align="center">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> world_sans_antarctica, </span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">fill =</span> <span class="st">"#669438"</span>, <span class="at">color =</span> <span class="st">"#32481B"</span>, <span class="at">linewidth =</span> <span class="fl">0.25</span>) <span class="sc">+</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf</span>(<span class="at">crs =</span> <span class="fu">st_crs</span>(<span class="st">"EPSG:3395"</span>)) <span class="sc">+</span>  <span class="co"># Mercator</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Or use the name instead of the number</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># coord_sf(crs = "+proj=merc")</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="12-example_files/figure-html/map-basic-mercator-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="us-map-with-different-projections" class="level2">
<h2 class="anchored" data-anchor-id="us-map-with-different-projections">US map with different projections</h2>
<p>This same process works for any shapefile. The map of the US can also be projected differently—two common projections are NAD83 and Albers. We’ll take the <code>us_states</code> dataset, remove Alaska, Hawaii, and Puerto Rico (they’re so far from the rest of the lower 48 states that they make an unusable map—see the next section for a way to include them), and plot it.</p>
<div class="cell" data-layout-align="center">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>lower_48 <span class="ot">&lt;-</span> us_states <span class="sc">|&gt;</span> </span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>(NAME <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Alaska"</span>, <span class="st">"Hawaii"</span>, <span class="st">"Puerto Rico"</span>)))</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> lower_48, <span class="at">fill =</span> <span class="st">"#192DA1"</span>, <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">linewidth =</span> <span class="fl">0.25</span>) <span class="sc">+</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf</span>(<span class="at">crs =</span> <span class="fu">st_crs</span>(<span class="st">"EPSG:4269"</span>)) <span class="sc">+</span>  <span class="co"># NAD83</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="12-example_files/figure-html/us-nad83-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-layout-align="center">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> lower_48, <span class="at">fill =</span> <span class="st">"#192DA1"</span>, <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">linewidth =</span> <span class="fl">0.25</span>) <span class="sc">+</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf</span>(<span class="at">crs =</span> <span class="fu">st_crs</span>(<span class="st">"ESRI:102003"</span>)) <span class="sc">+</span>  <span class="co"># Albers</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="12-example_files/figure-html/us-albers-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="us-map-with-non-continguous-parts" class="level2">
<h2 class="anchored" data-anchor-id="us-map-with-non-continguous-parts">US map with non-continguous parts</h2>
<p>Plotting places like Alaska, Hawaii, and Puerto Rico gets a little tricky since they’re far away from the contiguous 48 states. There’s an easy way to handle it though!</p>
<p>First, there’s a package named <a href="https://github.com/walkerke/tigris">{tigris}</a> that provides a neat interface for working with spatial data from the <a href="https://www.census.gov/geographies/mapping-files/time-series/geo/tiger-line-file.html">US Census’s TIGER shapefiles</a>. In addition to providing a ton of functions for getting shapefiles for states, counties, voting districts, Tribal areas, military bases, and dozens of other things, {tigris} has a <code>shift_geometry()</code> function that will change the coordinates for Alaska, Hawaii, and Puerto Rico so that they end up in Mexico and the Gulf of Mexico.</p>
<div class="cell" data-layout-align="center">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tigris)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="co"># This is the Census shapefile we loaded earlier. Note how we're not filtering</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="co"># out AK, HI, and PR now</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>us_states_shifted <span class="ot">&lt;-</span> us_states <span class="sc">|&gt;</span> </span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">shift_geometry</span>()  <span class="co"># Move AK, HI, and PR around</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> us_states_shifted) <span class="sc">+</span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf</span>(<span class="at">crs =</span> <span class="fu">st_crs</span>(<span class="st">"ESRI:102003"</span>)) <span class="sc">+</span>  <span class="co"># Albers</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="12-example_files/figure-html/tigris-shifting-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
<p>The <code>shift_geometry()</code> function should work on any shapefile. What if you have a shapefile with the coordinates of all public libraries in Alaska? Those will use the actual coordinates, not the shifted-to-Mexico coordinates. Feed that data to <code>shift_geometry()</code> and it should translate any coordinates you have in Alaska, Hawaii, and Puerto Rico to the Mexico area so they’ll plot correctly.</p>
<p><code>shift_geometry()</code> has an optional <code>position</code> argument that lets you control where the non-contiguous states go. By default they’ll go below the continental US (<code>position = "below"</code>), but you can also use <code>position = "outside"</code> to place them more in relation to where they are in real life:</p>
<div class="cell" data-layout-align="center">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>us_states_shifted <span class="ot">&lt;-</span> us_states <span class="sc">|&gt;</span> </span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">shift_geometry</span>(<span class="at">position =</span> <span class="st">"outside"</span>)</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> us_states_shifted) <span class="sc">+</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf</span>(<span class="at">crs =</span> <span class="fu">st_crs</span>(<span class="st">"ESRI:102003"</span>)) <span class="sc">+</span>  <span class="co"># Albers</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="12-example_files/figure-html/tigris-shifting-alt-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="individual-states" class="level2">
<h2 class="anchored" data-anchor-id="individual-states">Individual states</h2>
<p>Again, because these shapefiles are really just fancy data frames, we can filter them with normal dplyr functions. Let’s plot just Georgia:</p>
<div class="cell" data-layout-align="center">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>only_georgia <span class="ot">&lt;-</span> lower_48 <span class="sc">|&gt;</span> </span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(NAME <span class="sc">==</span> <span class="st">"Georgia"</span>)</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> only_georgia, <span class="at">fill =</span> <span class="st">"#EC8E55"</span>) <span class="sc">+</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="12-example_files/figure-html/georgia-only-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
<p>We can also use a different projection. If we look at <a href="http://epsg.io/">epsg.io</a>, there’s <a href="http://epsg.io/2239-1713">a version of NAD83 that’s focused specifically on Georgia</a>.</p>
<div class="cell" data-layout-align="center">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> only_georgia, <span class="at">fill =</span> <span class="st">"#EC8E55"</span>) <span class="sc">+</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf</span>(<span class="at">crs =</span> <span class="fu">st_crs</span>(<span class="st">"EPSG:2239"</span>))  <span class="co"># NAD83 focused on Georgia</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="12-example_files/figure-html/georgia-only-projection-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
<p>There’s one small final issue though: we’re missing all the Atlantic islands in the southeast like Cumberland Island and Amelia Island. That’s because we’re using the Census’s low resolution (20m) data. That’s fine for the map of the whole country, but if we’re looking at a single state, we probably want better detail in the borders. We can use the Census’s high resolution (500k) data, but even then it doesn’t include the islands for whatever reason, but <a href="https://www.naturalearthdata.com/downloads/10m-cultural-vectors/10m-admin-1-states-provinces/">Natural Earth has high resolution US state data</a> that <em>does</em> have the islands, so we can use that:</p>
<div class="cell" data-layout-align="center">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>only_georgia_high <span class="ot">&lt;-</span> us_states_hires <span class="sc">|&gt;</span> </span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(iso_3166_2 <span class="sc">==</span> <span class="st">"US-GA"</span>)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> only_georgia_high, <span class="at">fill =</span> <span class="st">"#EC8E55"</span>) <span class="sc">+</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf</span>(<span class="at">crs =</span> <span class="fu">st_crs</span>(<span class="st">"EPSG:2239"</span>))  <span class="co"># NAD83 focused on Georgia</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="12-example_files/figure-html/georgia-only-hires-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
<p>Perfect.</p>
</section>
<section id="plotting-multiple-shapefile-layers" class="level2">
<h2 class="anchored" data-anchor-id="plotting-multiple-shapefile-layers">Plotting multiple shapefile layers</h2>
<p>The state shapefiles from the Census Bureau only include state boundaries. If we want to see counties in Georgia, we need to download and load the Census’s county shapefiles (which we did above). We can then add a second <code>geom_sf()</code> layer for the counties.</p>
<p>First we need to filter the county data to only include Georgia counties. The counties data doesn’t include a column with the state name or state abbreviation, but it does include a column named <code>STATEFP</code>, which is the <a href="https://en.wikipedia.org/wiki/Federal_Information_Processing_Standard_state_code">state FIPS code</a>. Looking at <code>lower_48</code> we can see that the state FIPS code for Georgia is 13, so we use that to filter.</p>
<div class="cell" data-layout-align="center">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>ga_counties <span class="ot">&lt;-</span> us_counties <span class="sc">|&gt;</span> </span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(STATEFP <span class="sc">==</span> <span class="dv">13</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<p>Now we can plot just the counties:</p>
<div class="cell" data-layout-align="center">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> ga_counties) <span class="sc">+</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="12-example_files/figure-html/ga-counties-only-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
<p>Technically we can just draw the county boundaries instead of layer the state boundary + the counties, since the borders of the counties make up the border of the state. But there’s an advantage to including both: we can use different aesthetics on each, like adding a thicker border on the state:</p>
<div class="cell" data-layout-align="center">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> only_georgia_high, <span class="at">color =</span> <span class="st">"#EC8E55"</span>, <span class="at">linewidth =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> ga_counties, <span class="at">fill =</span> <span class="st">"#A5D46A"</span>, <span class="at">color =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="12-example_files/figure-html/ga-counties-in-state-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
<p>It’s also useful if we want to only show some counties, like metropolitan Atlanta:</p>
<div class="cell" data-layout-align="center">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>atl_counties <span class="ot">&lt;-</span> ga_counties <span class="sc">|&gt;</span> </span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(NAME <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Cherokee"</span>, <span class="st">"Clayton"</span>, <span class="st">"Cobb"</span>, <span class="st">"DeKalb"</span>, <span class="st">"Douglas"</span>,</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"Fayette"</span>, <span class="st">"Fulton"</span>, <span class="st">"Gwinnett"</span>, <span class="st">"Henry"</span>, <span class="st">"Rockdale"</span>))</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> only_georgia_high, <span class="at">fill =</span> <span class="st">"#EC8E55"</span>) <span class="sc">+</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> atl_counties, <span class="at">fill =</span> <span class="st">"#A5D46A"</span>, <span class="at">color =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="12-example_files/figure-html/atl-counties-in-state-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="plotting-multiple-shapefile-layers-when-some-are-bigger-than-the-parent-shape" class="level2">
<h2 class="anchored" data-anchor-id="plotting-multiple-shapefile-layers-when-some-are-bigger-than-the-parent-shape">Plotting multiple shapefile layers when some are bigger than the parent shape</h2>
<p>So far we’ve been able to filter out states and counties that we don’t want to plot using <code>filter()</code>, which works because the shapefiles have geometry data for each state or county. But what if you’re plotting stuff that doesn’t follow state or county boundaries, like freeways, roads, rivers, or lakes?</p>
<p>At the beginning we loaded a shapefile for all large and small rivers in the US. Look at the first few rows of <code>rivers_na</code>:</p>
<div class="cell" data-layout-align="center">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(rivers_na)</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="do">## Simple feature collection with 6 features and 40 fields</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="do">## Geometry type: MULTILINESTRING</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="do">## Dimension:     XY</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="do">## Bounding box:  xmin: -95 ymin: 36 xmax: -91 ymax: 40</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a><span class="do">## Geodetic CRS:  WGS 84</span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 6 × 41</span></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a><span class="do">##   strokeweig name   featurecla scalerank min_zoom min_label  ne_id rivernum dissolve name_alt note  name_full label wikidataid name_ar name_bn name_de</span></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a><span class="do">##        &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;          &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt; &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt; &lt;chr&gt;     &lt;chr&gt; &lt;chr&gt;      &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;  </span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a><span class="do">## 1       0.15 North… River             12        7         8 1.75e9       NA &lt;NA&gt;     &lt;NA&gt;     &lt;NA&gt;  &lt;NA&gt;      &lt;NA&gt;  &lt;NA&gt;       &lt;NA&gt;    &lt;NA&gt;    &lt;NA&gt;   </span></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a><span class="do">## 2       0.2  North… River             12        7         8 1.75e9       NA &lt;NA&gt;     &lt;NA&gt;     &lt;NA&gt;  &lt;NA&gt;      &lt;NA&gt;  &lt;NA&gt;       &lt;NA&gt;    &lt;NA&gt;    &lt;NA&gt;   </span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a><span class="do">## 3       0.2  Salt   River             12        7         8 1.16e9    22682 22682Ri… &lt;NA&gt;     ID i… Salt Riv… Salt  Q745070    &lt;NA&gt;    &lt;NA&gt;    &lt;NA&gt;   </span></span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a><span class="do">## 4       0.15 Spring River             12        7         8 1.75e9       NA &lt;NA&gt;     &lt;NA&gt;     &lt;NA&gt;  &lt;NA&gt;      &lt;NA&gt;  &lt;NA&gt;       &lt;NA&gt;    &lt;NA&gt;    &lt;NA&gt;   </span></span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a><span class="do">## 5       0.2  Spring River             12        7         8 1.75e9       NA &lt;NA&gt;     &lt;NA&gt;     &lt;NA&gt;  &lt;NA&gt;      &lt;NA&gt;  Q7580668   &lt;NA&gt;    &lt;NA&gt;    &lt;NA&gt;   </span></span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a><span class="do">## 6       0.15 Illin… River             12        7         8 1.16e9    22643 22643Ri… &lt;NA&gt;     ID i… Illinois… Illi… Q5999623   &lt;NA&gt;    &lt;NA&gt;    &lt;NA&gt;   </span></span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a><span class="do">## # ℹ 24 more variables: name_en &lt;chr&gt;, name_es &lt;chr&gt;, name_fr &lt;chr&gt;, name_el &lt;chr&gt;, name_hi &lt;chr&gt;, name_hu &lt;chr&gt;, name_id &lt;chr&gt;, name_it &lt;chr&gt;,</span></span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a><span class="do">## #   name_ja &lt;chr&gt;, name_ko &lt;chr&gt;, name_nl &lt;chr&gt;, name_pl &lt;chr&gt;, name_pt &lt;chr&gt;, name_ru &lt;chr&gt;, name_sv &lt;chr&gt;, name_tr &lt;chr&gt;, name_vi &lt;chr&gt;,</span></span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a><span class="do">## #   name_zh &lt;chr&gt;, name_fa &lt;chr&gt;, name_he &lt;chr&gt;, name_uk &lt;chr&gt;, name_ur &lt;chr&gt;, name_zht &lt;chr&gt;, geometry &lt;MULTILINESTRING [°]&gt;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<p>The first row is the whole Colorado river, which flows through seven states. We can’t just use <code>filter()</code> to only select some parts of it based on states.</p>
<p>Here’s what happens if we combine our Georgia map with rivers and lakes:</p>
<div class="cell" data-layout-align="center">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> only_georgia, <span class="at">fill =</span> <span class="st">"#EC8E55"</span>) <span class="sc">+</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> rivers_na) <span class="sc">+</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="12-example_files/figure-html/ga-rivers-bad-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
<p>It plots Georgia, and it’s filled with orange, but it also plots every single river in North America. Oops.</p>
<p>We need to do a little GIS work to basically use <code>only_georgia</code> as a cookie cutter and keep only the rivers that are contained in the <code>only_georgia</code> boundaries. Fortunately, there’s a function in the {sf} package that does this: <code>st_intersection()</code>. Feed it two shapefile datasets and it will select the parts of the second that fall within the boundaries of the first:</p>
<div class="cell" data-layout-align="center">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>ga_rivers_na <span class="ot">&lt;-</span> <span class="fu">st_intersection</span>(only_georgia, rivers_na)</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="do">## Error in geos_op2_geom("intersection", x, y, ...): st_crs(x) == st_crs(y) is not TRUE</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<p>Oh no! An error! It’s complaining that the reference systems used in these two datasets don’t match. We can check the CRS with <code>st_crs()</code>:</p>
<div class="cell" data-layout-align="center">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">st_crs</span>(only_georgia)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="do">## Coordinate Reference System:</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="do">##   User input: NAD83 </span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a><span class="do">##   wkt:</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a><span class="do">## GEOGCRS["NAD83",</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a><span class="do">##     DATUM["North American Datum 1983",</span></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a><span class="do">##         ELLIPSOID["GRS 1980",6378137,298.257222101,</span></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a><span class="do">##             LENGTHUNIT["metre",1]]],</span></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a><span class="do">##     PRIMEM["Greenwich",0,</span></span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a><span class="do">##         ANGLEUNIT["degree",0.0174532925199433]],</span></span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a><span class="do">##     CS[ellipsoidal,2],</span></span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a><span class="do">##         AXIS["latitude",north,</span></span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a><span class="do">##             ORDER[1],</span></span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a><span class="do">##             ANGLEUNIT["degree",0.0174532925199433]],</span></span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a><span class="do">##         AXIS["longitude",east,</span></span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a><span class="do">##             ORDER[2],</span></span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a><span class="do">##             ANGLEUNIT["degree",0.0174532925199433]],</span></span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a><span class="do">##     ID["EPSG",4269]]</span></span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a><span class="fu">st_crs</span>(rivers_na)</span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a><span class="do">## Coordinate Reference System:</span></span>
<span id="cb25-21"><a href="#cb25-21" aria-hidden="true" tabindex="-1"></a><span class="do">##   User input: WGS 84 </span></span>
<span id="cb25-22"><a href="#cb25-22" aria-hidden="true" tabindex="-1"></a><span class="do">##   wkt:</span></span>
<span id="cb25-23"><a href="#cb25-23" aria-hidden="true" tabindex="-1"></a><span class="do">## GEOGCRS["WGS 84",</span></span>
<span id="cb25-24"><a href="#cb25-24" aria-hidden="true" tabindex="-1"></a><span class="do">##     DATUM["World Geodetic System 1984",</span></span>
<span id="cb25-25"><a href="#cb25-25" aria-hidden="true" tabindex="-1"></a><span class="do">##         ELLIPSOID["WGS 84",6378137,298.257223563,</span></span>
<span id="cb25-26"><a href="#cb25-26" aria-hidden="true" tabindex="-1"></a><span class="do">##             LENGTHUNIT["metre",1]]],</span></span>
<span id="cb25-27"><a href="#cb25-27" aria-hidden="true" tabindex="-1"></a><span class="do">##     PRIMEM["Greenwich",0,</span></span>
<span id="cb25-28"><a href="#cb25-28" aria-hidden="true" tabindex="-1"></a><span class="do">##         ANGLEUNIT["degree",0.0174532925199433]],</span></span>
<span id="cb25-29"><a href="#cb25-29" aria-hidden="true" tabindex="-1"></a><span class="do">##     CS[ellipsoidal,2],</span></span>
<span id="cb25-30"><a href="#cb25-30" aria-hidden="true" tabindex="-1"></a><span class="do">##         AXIS["latitude",north,</span></span>
<span id="cb25-31"><a href="#cb25-31" aria-hidden="true" tabindex="-1"></a><span class="do">##             ORDER[1],</span></span>
<span id="cb25-32"><a href="#cb25-32" aria-hidden="true" tabindex="-1"></a><span class="do">##             ANGLEUNIT["degree",0.0174532925199433]],</span></span>
<span id="cb25-33"><a href="#cb25-33" aria-hidden="true" tabindex="-1"></a><span class="do">##         AXIS["longitude",east,</span></span>
<span id="cb25-34"><a href="#cb25-34" aria-hidden="true" tabindex="-1"></a><span class="do">##             ORDER[2],</span></span>
<span id="cb25-35"><a href="#cb25-35" aria-hidden="true" tabindex="-1"></a><span class="do">##             ANGLEUNIT["degree",0.0174532925199433]],</span></span>
<span id="cb25-36"><a href="#cb25-36" aria-hidden="true" tabindex="-1"></a><span class="do">##     ID["EPSG",4326]]</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<p>The Georgia map uses EPSG:4269 (<a href="https://epsg.io/4269">or NAD83</a>), while the rivers map uses EPSG:4326 (or <a href="https://epsg.io/4326">the GPS system of latitude and longitude</a>). We need to convert one of them to make them match. It doesn’t matter which one.</p>
<div class="cell" data-layout-align="center">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>only_georgia_4326 <span class="ot">&lt;-</span> only_georgia <span class="sc">|&gt;</span> </span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="at">crs =</span> <span class="fu">st_crs</span>(<span class="st">"EPSG:4326"</span>))</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>ga_rivers_na <span class="ot">&lt;-</span> <span class="fu">st_intersection</span>(only_georgia_4326, rivers_na)</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a><span class="do">## Warning: attribute variables are assumed to be spatially constant throughout all geometries</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<p>You’ll get an ominous warning, but you should be okay—it’s just because flattening globes into flat planes is hard, and the cutting <a href="https://github.com/r-spatial/sf/issues/493">might not be 100% accurate</a>, but it’ll be close enough for our mapping purposes.</p>
<p>Now we can plot our state shape and the truncated rivers:</p>
<div class="cell" data-layout-align="center">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> only_georgia, <span class="at">fill =</span> <span class="st">"#EC8E55"</span>) <span class="sc">+</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> ga_rivers_na) <span class="sc">+</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="12-example_files/figure-html/ga-rivers-good-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
<p>Hey! It worked! Let’s put all the rivers and lakes on at once and make it a little more artsy. We’ll use the high resolution Georgia map too, which conveniently already matches the CRS of the rivers and lakes:</p>
<div class="cell" data-layout-align="center">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>ga_rivers_na <span class="ot">&lt;-</span> <span class="fu">st_intersection</span>(only_georgia_high, rivers_na)</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>ga_rivers_global <span class="ot">&lt;-</span> <span class="fu">st_intersection</span>(only_georgia_high, rivers_global)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a><span class="co"># sf v1.0 changed how it handles shapefiles with spherical elements, which</span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="co"># apparently the lakes data uses. Currently when using st_intersection() and</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="co"># other GIS-related functions, it breaks. This can be fixed by feeding the lakes</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="co"># data to st_make_valid(), which does something fancy behind the scenes to make</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a><span class="co"># it work. See this: https://github.com/r-spatial/sf/issues/1649#issuecomment-853279986</span></span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>ga_lakes <span class="ot">&lt;-</span> <span class="fu">st_intersection</span>(only_georgia_high, <span class="fu">st_make_valid</span>(lakes))</span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> only_georgia_high, </span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a>          <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">linewidth =</span> <span class="fl">0.1</span>, <span class="at">fill =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> ga_rivers_global, <span class="at">linewidth =</span> <span class="fl">0.3</span>, <span class="at">color =</span> <span class="st">"grey80"</span>) <span class="sc">+</span></span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> ga_rivers_na, <span class="at">linewidth =</span> <span class="fl">0.15</span>, <span class="at">color =</span> <span class="st">"grey80"</span>) <span class="sc">+</span></span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> ga_lakes, <span class="at">linewidth =</span> <span class="fl">0.3</span>, <span class="at">fill =</span> <span class="st">"grey80"</span>, <span class="at">color =</span> <span class="cn">NA</span>) <span class="sc">+</span></span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf</span>(<span class="at">crs =</span> <span class="fu">st_crs</span>(<span class="st">"EPSG:4326"</span>)) <span class="sc">+</span>  <span class="co"># NAD83</span></span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="12-example_files/figure-html/ga-all-water-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="960"></p>
</figure>
</div>
</div>
</div>
<p>Heck yeah. That’s a great map. This is basically what <a href="https://kieranhealy.org/prints/rivers/">Kieran Healy did here</a>, but he used <a href="https://www.usgs.gov/core-science-systems/ngp/national-hydrography">even more detailed shapefiles from the US Geological Survey</a>.</p>
</section>
<section id="plotting-schools-in-georgia" class="level2">
<h2 class="anchored" data-anchor-id="plotting-schools-in-georgia">Plotting schools in Georgia</h2>
<p>Shapefiles are not limited to just lines and areas—they can also contain points. I made a free account at the Georgia GIS Clearinghouse, searched for “schools” and found a shapefile of all the K–12 schools in 2009. <a href="https://data.georgiaspatial.org/index.asp?body=preview&amp;dataId=41516">This is the direct link to the page</a>, but it only works if you’re logged in to their system. <a href="https://data.georgiaspatial.org/data/statewide/other/schools_2009.html">This is the official metadata for the shapefile</a>, which you can see if you’re not logged in, but you can’t download anything. It’s a dumb system and other states are a lot better at offering their GIS data (like, <a href="https://gis.utah.gov/data/society/schools-libraries/">here’s a shapefile of all of Utah’s schools and libraries</a> as of 2017, publicly accessible without an account).</p>
<p>We loaded the shapefile up at the top, but now let’s look at it:</p>
<div class="cell" data-layout-align="center">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(ga_schools)</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="do">## Simple feature collection with 6 features and 16 fields</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="do">## Geometry type: POINT</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a><span class="do">## Dimension:     XY</span></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a><span class="do">## Bounding box:  xmin: 2100000 ymin: 320000 xmax: 2200000 ymax: 5e+05</span></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a><span class="do">## Projected CRS: NAD83 / Georgia West (ftUS)</span></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 6 × 17</span></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a><span class="do">##      ID  DATA COUNTY  DISTRICT   SCHOOLNAME GRADES ADDRESS CITY  STATE ZIP   TOTAL SCHOOLID DOE_CONGRE CONGRESS SENATE HOUSE                 geometry</span></span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a><span class="do">##   &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;  &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt;    &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;    &lt;chr&gt;  &lt;chr&gt; &lt;POINT [US_survey_foot]&gt;</span></span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a><span class="do">## 1  4313   224 Early   Early Cou… Early Cou… PK,KK… 283 Ma… Blak… GA    3982…  1175    43549 2          002      011    149           (2052182 494322)</span></span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a><span class="do">## 2  4321   227 Early   Early Cou… ETN Ecker… 06,07… 313 E … Blak… GA    3982…    30    47559 2          002      011    149            (2053200 5e+05)</span></span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a><span class="do">## 3  4329   226 Early   Early Cou… Early Cou… 06,07… 12053 … Blak… GA    3982…   539    43550 2          002      011    149            (2055712 5e+05)</span></span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a><span class="do">## 4  4337   225 Early   Early Cou… Early Cou… 09,10… 12020 … Blak… GA    3982…   716    43552 2          002      011    149            (2055712 5e+05)</span></span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a><span class="do">## 5  4345   189 Decatur Decatur C… John John… PK,KK… 1947 S… Bain… GA    3981…   555    43279 2          002      011    172           (2168090 321781)</span></span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a><span class="do">## 6  4353   192 Decatur Decatur C… Potter St… PK,KK… 725 Po… Bain… GA    3981…   432    43273 2          002      011    172           (2168751 327375)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<p>We have a bunch of columns like <code>GRADES</code> that has a list of what grades are included in the school, and <code>TOTAL</code>, which I’m guessing is the number of students. Let’s map it!</p>
<p>If we add a <code>geom_sf()</code> layer just for <code>ga_schools</code>, it’ll plot a bunch of points:</p>
<div class="cell" data-layout-align="center">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> ga_schools)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="12-example_files/figure-html/plot-ga-schools-initial-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
<p>One of these rows is wildly miscoded and ended up Indonesia! If you sort by the <code>geometry</code> column in RStudio, you’ll see that it’s most likely Allatoona High School in Cobb County (id = 22097). The coordinates are different from all the others, and it has no congressional district information. Let’s remove it.</p>
<div class="cell" data-layout-align="center">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>ga_schools_fixed <span class="ot">&lt;-</span> ga_schools <span class="sc">|&gt;</span> </span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(ID <span class="sc">!=</span> <span class="dv">22097</span>)</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> ga_schools_fixed)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="12-example_files/figure-html/plot-ga-schools-fixed-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
<p>That’s better. However, all we’re plotting now are the points—we’ve lost the state and/or county boundaries. Let’s include those:</p>
<div class="cell" data-layout-align="center">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> only_georgia_high) <span class="sc">+</span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> ga_schools_fixed) <span class="sc">+</span></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="12-example_files/figure-html/plot-ga-schools-borders-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
<p>We’re getting closer. We have some issues with overplotting, so let’s shrink the points down and make them a little transparent:</p>
<div class="cell" data-layout-align="center">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> only_georgia_high) <span class="sc">+</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> ga_schools_fixed, <span class="at">size =</span> <span class="fl">0.5</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="12-example_files/figure-html/plot-ga-schools-shrunk-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
<p>Neat. One last thing we can do is map the <code>TOTAL</code> column to the color aesthetic and color the points by how many students attend each school:</p>
<div class="cell" data-layout-align="center">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> only_georgia_high) <span class="sc">+</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> ga_schools_fixed, <span class="fu">aes</span>(<span class="at">color =</span> TOTAL), <span class="at">size =</span> <span class="fl">0.75</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_viridis_c</span>() <span class="sc">+</span></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="12-example_files/figure-html/plot-ga-schools-color-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
<p>Most schools appear to be under 1,000 students, except for a cluster in Gwinnett County north of Atlanta. Its high schools have nearly 4,000 students each!</p>
<div class="cell" data-layout-align="center">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>ga_schools_fixed <span class="sc">|&gt;</span> </span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(COUNTY, SCHOOLNAME, TOTAL) <span class="sc">|&gt;</span> </span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(TOTAL)) <span class="sc">|&gt;</span> </span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>()</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a><span class="do">## Simple feature collection with 6 features and 3 fields</span></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a><span class="do">## Geometry type: POINT</span></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a><span class="do">## Dimension:     XY</span></span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a><span class="do">## Bounding box:  xmin: 2300000 ymin: 1400000 xmax: 2400000 ymax: 1500000</span></span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a><span class="do">## Projected CRS: NAD83 / Georgia West (ftUS)</span></span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 6 × 4</span></span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a><span class="do">##   COUNTY   SCHOOLNAME                  TOTAL                 geometry</span></span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a><span class="do">##   &lt;chr&gt;    &lt;chr&gt;                       &lt;dbl&gt; &lt;POINT [US_survey_foot]&gt;</span></span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a><span class="do">## 1 Gwinnett Mill Creek High School       3997        (2384674 1482772)</span></span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a><span class="do">## 2 Gwinnett Collins Hill High School     3720        (2341010 1461730)</span></span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a><span class="do">## 3 Gwinnett Brookwood High School        3455        (2334543 1413396)</span></span>
<span id="cb35-16"><a href="#cb35-16" aria-hidden="true" tabindex="-1"></a><span class="do">## 4 Gwinnett Grayson High School          3230        (2370186 1408579)</span></span>
<span id="cb35-17"><a href="#cb35-17" aria-hidden="true" tabindex="-1"></a><span class="do">## 5 Gwinnett Peachtree Ridge High School  3118        (2319344 1459458)</span></span>
<span id="cb35-18"><a href="#cb35-18" aria-hidden="true" tabindex="-1"></a><span class="do">## 6 Gwinnett Berkmar High School          3095        (2312983 1421933)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
</section>
<section id="making-your-own-geocoded-data" class="level2">
<h2 class="anchored" data-anchor-id="making-your-own-geocoded-data">Making your own geocoded data</h2>
<p>So, plotting shapefiles with <code>geom_sf()</code> is magical because {sf} deals with all of the projection issues for us automatically and it figures out how to plot all the latitude and longitude data for us automatically. But lots of data <em>doesn’t</em> some as shapefiles. The <a href="../assignment/01-mini-project.html">rats data from mini project 1</a>, for instance, has two columns indicating the latitude and longitude of each rat sighting, but those are stored as just numbers. If we try to use <code>geom_sf()</code> with the rat data, it won’t work. We need that magical <code>geometry</code> column.</p>
<p>Fortunately, if we have latitude and longitude information, we can make our own <code>geometry</code> column.</p>
<p>Let’s say we want to mark some cities on our map of Georgia. We can make a mini dataset using <code>tribble()</code>. I found these points from Google Maps: right click anywhere in Google Maps, select “What’s here?”, and you’ll see the exact coordinates for that spot.</p>
<div class="cell" data-layout-align="center">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>ga_cities <span class="ot">&lt;-</span> <span class="fu">tribble</span>(</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>  <span class="sc">~</span>city, <span class="sc">~</span>lat, <span class="sc">~</span>long,</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Atlanta"</span>, <span class="fl">33.748955</span>, <span class="sc">-</span><span class="fl">84.388099</span>,</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Athens"</span>, <span class="fl">33.950794</span>, <span class="sc">-</span><span class="fl">83.358884</span>,</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Savannah"</span>, <span class="fl">32.113192</span>, <span class="sc">-</span><span class="fl">81.089350</span></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>ga_cities</span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 3 × 3</span></span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a><span class="do">##   city       lat  long</span></span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a><span class="do">##   &lt;chr&gt;    &lt;dbl&gt; &lt;dbl&gt;</span></span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a><span class="do">## 1 Atlanta   33.7 -84.4</span></span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a><span class="do">## 2 Athens    34.0 -83.4</span></span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a><span class="do">## 3 Savannah  32.1 -81.1</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<p>This is just a normal dataset, and the <code>lat</code> and <code>long</code> columns are just numbers. R doesn’t know that those are actually geographic coordinates. This is similar to the rats data, or any other data that has columns for latitude and longitude.</p>
<p>We can convert those two columns to the magic <code>geometry</code> column with the <code>st_as_sf()</code> function. We have to define two things in the function: which coordinates are the longitude and latitude, and what CRS the coordinates are using. Google Maps uses <a href="http://epsg.io/4326">EPSG:4326, or the GPS system</a>, so we specify that:</p>
<div class="cell" data-layout-align="center">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>ga_cities_geometry <span class="ot">&lt;-</span> ga_cities <span class="sc">|&gt;</span> </span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_as_sf</span>(<span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"long"</span>, <span class="st">"lat"</span>), <span class="at">crs =</span> <span class="fu">st_crs</span>(<span class="st">"EPSG:4326"</span>))</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>ga_cities_geometry</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a><span class="do">## Simple feature collection with 3 features and 1 field</span></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a><span class="do">## Geometry type: POINT</span></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a><span class="do">## Dimension:     XY</span></span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a><span class="do">## Bounding box:  xmin: -84 ymin: 32 xmax: -81 ymax: 34</span></span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a><span class="do">## Geodetic CRS:  WGS 84</span></span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 3 × 2</span></span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a><span class="do">##   city        geometry</span></span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a><span class="do">## * &lt;chr&gt;    &lt;POINT [°]&gt;</span></span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a><span class="do">## 1 Atlanta     (-84 34)</span></span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a><span class="do">## 2 Athens      (-83 34)</span></span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a><span class="do">## 3 Savannah    (-81 32)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<p>The longitude and latitude columns are gone now, and we have a single magical <code>geometry</code> column. That means we can plot it with <code>geom_sf()</code>:</p>
<div class="cell" data-layout-align="center">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> only_georgia_high, <span class="at">fill =</span> <span class="st">"#EC8E55"</span>) <span class="sc">+</span></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> ga_cities_geometry, <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="12-example_files/figure-html/ga-with-cities-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
<p>We can use <code>geom_sf_label()</code> (or <code>geom_sf_text()</code>) to add labels in the correct locations too. It will give you a warning, but you can ignore it—again, it’s complaining that the positioning might not be 100% accurate because of issues related to taking a globe and flattening it. It’s fine.</p>
<div class="cell" data-layout-align="center">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> only_georgia_high, <span class="at">fill =</span> <span class="st">"#EC8E55"</span>) <span class="sc">+</span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> ga_cities_geometry, <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf_label</span>(<span class="at">data =</span> ga_cities_geometry, <span class="fu">aes</span>(<span class="at">label =</span> city),</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>                <span class="at">nudge_y =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="12-example_files/figure-html/ga-with-cities-text-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="960"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="automatic-geocoding-by-address" class="level2">
<h2 class="anchored" data-anchor-id="automatic-geocoding-by-address">Automatic geocoding by address</h2>
<p>Using <code>st_as_sf()</code> is neat when you have latitude and longitude data already, but what if you have a list of addresses or cities instead, with no fancy geographic information? It’s easy enough to right click on Google Maps, but you don’t really want to do that hundreds of times for large-scale data.</p>
<p>Fortunately there are a bunch of different online geocoding services that return GIS data for addresses and locations that you feed them, like magic.</p>
<p>The easiest way to use any of these services is to use the <a href="https://jessecambon.github.io/tidygeocoder/">{tidygeocoder}</a> package, which connects with all these different free and paid services (run <code>?geo</code> in R for complete details):</p>
<ul>
<li><code>"osm"</code>: OpenStreetMap through <a href="https://nominatim.org/">Nominatim</a>. <strong>FREE</strong>.</li>
<li><code>"census"</code>: <a href="https://geocoding.geo.census.gov/">US Census</a>. Geographic coverage is limited to the United States. <strong>FREE</strong>.</li>
<li><code>"arcgis"</code>: <a href="https://developers.arcgis.com/rest/geocode/api-reference/overview-world-geocoding-service.htm">ArcGIS</a>. <strong>FREE</strong> and paid.</li>
<li><code>"geocodio"</code>: <a href="https://www.geocod.io/">Geocodio</a>. Geographic coverage is limited to the United States and Canada. An API key must be stored in <code>"GEOCODIO_API_KEY"</code>.</li>
<li><code>"iq"</code>: <a href="https://locationiq.com/">Location IQ</a>. An API key must be stored in <code>"LOCATIONIQ_API_KEY"</code>.</li>
<li><code>"google"</code>: <a href="https://developers.google.com/maps/documentation/geocoding/overview">Google</a>. An API key must be stored in <code>"GOOGLEGEOCODE_API_KEY"</code>.</li>
<li><code>"opencage"</code>: <a href="https://opencagedata.com/">OpenCage</a>. An API key must be stored in <code>"OPENCAGE_KEY"</code>.</li>
<li><code>"mapbox"</code>: <a href="https://docs.mapbox.com/api/search/">Mapbox</a>. An API key must be stored in <code>"MAPBOX_API_KEY"</code>.</li>
<li><code>"here"</code>: <a href="https://developer.here.com/products/geocoding-and-search">HERE</a>. An API key must be stored in <code>"HERE_API_KEY"</code>.</li>
<li><code>"tomtom"</code>: <a href="https://developer.tomtom.com/search-api/search-api-documentation/geocoding">TomTom</a>. An API key must be stored in <code>"TOMTOM_API_KEY"</code>.</li>
<li><code>"mapquest"</code>: <a href="https://developer.mapquest.com/documentation/geocoding-api/">MapQuest</a>. An API key must be stored in <code>"MAPQUEST_API_KEY"</code>.</li>
<li><code>"bing"</code>: <a href="https://docs.microsoft.com/en-us/bingmaps/rest-services/locations/">Bing</a>. An API key must be stored in <code>"BINGMAPS_API_KEY"</code>.</li>
</ul>
<p>Not all services work equally well, and the free ones have rate limits (like, don’t try to geocode a million rows of data with the US Census), so you’ll have to play around with different services. You can also provide a list of services and {tidygeocoder} will cascade through them—if it can’t geocode an address with OpenStreetMap, it can move on to the Census, then ArcGIS, and so on. You need to set the <code>cascade_order</code> argument in <code>geocode()</code> for this to work.</p>
<p>Let’s make a little dataset with some addresses to geocode:</p>
<div class="cell" data-layout-align="center">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>some_addresses <span class="ot">&lt;-</span> <span class="fu">tribble</span>(</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>  <span class="sc">~</span>name,             <span class="sc">~</span>address,</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">"The White House"</span>, <span class="st">"1600 Pennsylvania Ave NW, Washington, DC"</span>,</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">"The Andrew Young School of Policy Studies"</span>, <span class="st">"55 Park Place SE, Atlanta, GA 30303"</span></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>some_addresses</span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 2 × 2</span></span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a><span class="do">##   name                                      address                                 </span></span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a><span class="do">##   &lt;chr&gt;                                     &lt;chr&gt;                                   </span></span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a><span class="do">## 1 The White House                           1600 Pennsylvania Ave NW, Washington, DC</span></span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a><span class="do">## 2 The Andrew Young School of Policy Studies 55 Park Place SE, Atlanta, GA 30303</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<p>To geocode these addresses, we can feed this data into <code>geocode()</code> and tell it to use the <code>address</code> column. We’ll use the Census geocoding system for fun (surely they know where the White House is):</p>
<div class="cell" data-layout-align="center">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidygeocoder)</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>geocoded_addresses <span class="ot">&lt;-</span> some_addresses <span class="sc">|&gt;</span> </span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geocode</span>(address, <span class="at">method =</span> <span class="st">"census"</span>)</span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>geocoded_addresses</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<div class="cell" data-layout-align="center">
<pre><code>## # A tibble: 2 × 3
##   name                                        lat  long
##   &lt;chr&gt;                                     &lt;dbl&gt; &lt;dbl&gt;
## 1 The White House                            38.9 -77.0
## 2 The Andrew Young School of Policy Studies  33.8 -84.4</code></pre>
</div>
<p>It worked!</p>
<p>Those are just numbers, though, and not the magical <code>geometry</code> column, so we need to use <code>st_as_sf()</code> to convert them to actual GIS data.</p>
<div class="cell" data-layout-align="center">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>addresses_geometry <span class="ot">&lt;-</span> geocoded_addresses <span class="sc">|&gt;</span> </span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_as_sf</span>(<span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"long"</span>, <span class="st">"lat"</span>), <span class="at">crs =</span> <span class="fu">st_crs</span>(<span class="st">"EPSG:4326"</span>))</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>addresses_geometry <span class="sc">|&gt;</span> <span class="fu">select</span>(<span class="sc">-</span>address)</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a><span class="do">## Simple feature collection with 2 features and 1 field</span></span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a><span class="do">## Geometry type: POINT</span></span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a><span class="do">## Dimension:     XY</span></span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a><span class="do">## Bounding box:  xmin: -84 ymin: 34 xmax: -77 ymax: 39</span></span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a><span class="do">## Geodetic CRS:  WGS 84</span></span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 2 × 2</span></span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a><span class="do">##   name                                         geometry</span></span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a><span class="do">##   &lt;chr&gt;                                     &lt;POINT [°]&gt;</span></span>
<span id="cb43-13"><a href="#cb43-13" aria-hidden="true" tabindex="-1"></a><span class="do">## 1 The White House                              (-77 39)</span></span>
<span id="cb43-14"><a href="#cb43-14" aria-hidden="true" tabindex="-1"></a><span class="do">## 2 The Andrew Young School of Policy Studies    (-84 34)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<p>Let’s plot these on a US map:</p>
<div class="cell" data-layout-align="center">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> lower_48, <span class="at">fill =</span> <span class="st">"#192DA1"</span>, <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">linewidth =</span> <span class="fl">0.25</span>) <span class="sc">+</span></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> addresses_geometry, <span class="at">size =</span> <span class="dv">5</span>, <span class="at">color =</span> <span class="st">"#FF851B"</span>) <span class="sc">+</span></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Albers uses meters as its unit of measurement, so we need to nudge these</span></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># labels up by a lot. I only settled on 175,000 here after a bunch of trial</span></span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># and error, adding single zeroes and rerunning the plot until the labels</span></span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># moved. 175,000 meters = 108.74 miles</span></span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf_label</span>(<span class="at">data =</span> addresses_geometry, <span class="fu">aes</span>(<span class="at">label =</span> name),</span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a>                <span class="at">size =</span> <span class="dv">4</span>, <span class="at">fill =</span> <span class="st">"#FF851B"</span>, <span class="at">nudge_y =</span> <span class="dv">175000</span>) <span class="sc">+</span> </span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf</span>(<span class="at">crs =</span> <span class="fu">st_crs</span>(<span class="st">"ESRI:102003"</span>)) <span class="sc">+</span>  <span class="co"># Albers</span></span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="12-example_files/figure-html/plot-geocoded-cities-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="plotting-other-data-on-maps" class="level2">
<h2 class="anchored" data-anchor-id="plotting-other-data-on-maps">Plotting other data on maps</h2>
<p>So far we’ve just plotted whatever data the shapefile creators decided to include and publish in their data. But what if you want to visualize some other variable on a map? We can do this by combining our shapefile data with any other kind of data, as long as the two have a shared column. For instance, we can make a choropleth map of life expectancy with data from the World Bank.</p>
<p>First, let’s grab some data from the World Bank for just 2015:</p>
<div class="cell" data-layout-align="center">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(WDI)  <span class="co"># For getting data from the World Bank</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>indicators <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="at">life_expectancy =</span> <span class="st">"SP.DYN.LE00.IN"</span>)  <span class="co"># Life expectancy</span></span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>wdi_raw <span class="ot">&lt;-</span> <span class="fu">WDI</span>(<span class="at">country =</span> <span class="st">"all"</span>, indicators, <span class="at">extra =</span> <span class="cn">TRUE</span>, </span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>               <span class="at">start =</span> <span class="dv">2015</span>, <span class="at">end =</span> <span class="dv">2015</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<p>Let’s see what we got:</p>
<div class="cell" data-layout-align="center">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(wdi_raw)</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 6 × 13</span></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a><span class="do">##   country                     iso2c iso3c  year life_expectancy status lastupdated region                    capital longitude latitude income lending</span></span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a><span class="do">##   &lt;chr&gt;                       &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt;           &lt;dbl&gt; &lt;lgl&gt;  &lt;date&gt;      &lt;chr&gt;                     &lt;chr&gt;       &lt;dbl&gt;    &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;  </span></span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a><span class="do">## 1 Afghanistan                 AF    AFG    2015            62.3 NA     2026-02-24  South Asia                Kabul       69.2      34.5 Low i… IDA    </span></span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a><span class="do">## 2 Africa Eastern and Southern ZH    AFE    2015            61.7 NA     2026-02-24  Aggregates                &lt;NA&gt;        NA        NA   Aggre… Aggreg…</span></span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a><span class="do">## 3 Africa Western and Central  ZI    AFW    2015            56.0 NA     2026-02-24  Aggregates                &lt;NA&gt;        NA        NA   Aggre… Aggreg…</span></span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a><span class="do">## 4 Albania                     AL    ALB    2015            78.4 NA     2026-02-24  Europe &amp; Central Asia     Tirane      19.8      41.3 Upper… IBRD   </span></span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a><span class="do">## 5 Algeria                     DZ    DZA    2015            75.2 NA     2026-02-24  Middle East &amp; North Afri… Algiers      3.05     36.7 Upper… IBRD   </span></span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a><span class="do">## 6 American Samoa              AS    ASM    2015            72.7 NA     2026-02-24  East Asia &amp; Pacific       Pago P…   -171.      -14.3 High … Not cl…</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<p>We have a bunch of columns here, but we care about two in particular: life expectancy, and the ISO3 code. This three-letter code is a standard system for identifying countries (<a href="https://en.wikipedia.org/wiki/ISO_3166-1_alpha-3">see the full list here</a>), and that column will let us combine this World Bank data with the global shapefile, which also has a column for the ISO3 code.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>World capitals
</div>
</div>
<div class="callout-body-container callout-body">
<p>We also have columns for the latitude and longitude for each capital, so we could theoretically convert those to a <code>geometry</code> column with <code>st_as_sf()</code> and plot world capitals, which would be neat, but we won’t do that now.</p>
</div>
</div>
<p>Let’s clean up the WDI data by shrinking it down substantially so we only join the one <code>life_expectancy</code> column that we care about:</p>
<div class="cell" data-layout-align="center">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>wdi_clean_small <span class="ot">&lt;-</span> wdi_raw <span class="sc">|&gt;</span> </span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(life_expectancy, iso3c)</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>wdi_clean_small</span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 266 × 2</span></span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a><span class="do">##    life_expectancy iso3c</span></span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a><span class="do">##              &lt;dbl&gt; &lt;chr&gt;</span></span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a><span class="do">##  1            62.3 AFG  </span></span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a><span class="do">##  2            61.7 AFE  </span></span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a><span class="do">##  3            56.0 AFW  </span></span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a><span class="do">##  4            78.4 ALB  </span></span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a><span class="do">##  5            75.2 DZA  </span></span>
<span id="cb47-12"><a href="#cb47-12" aria-hidden="true" tabindex="-1"></a><span class="do">##  6            72.7 ASM  </span></span>
<span id="cb47-13"><a href="#cb47-13" aria-hidden="true" tabindex="-1"></a><span class="do">##  7            84.5 AND  </span></span>
<span id="cb47-14"><a href="#cb47-14" aria-hidden="true" tabindex="-1"></a><span class="do">##  8            61.0 AGO  </span></span>
<span id="cb47-15"><a href="#cb47-15" aria-hidden="true" tabindex="-1"></a><span class="do">##  9            76.9 ATG  </span></span>
<span id="cb47-16"><a href="#cb47-16" aria-hidden="true" tabindex="-1"></a><span class="do">## 10            70.7 ARB  </span></span>
<span id="cb47-17"><a href="#cb47-17" aria-hidden="true" tabindex="-1"></a><span class="do">## # ℹ 256 more rows</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<p>Next we need to merge this tiny dataset into the <code>world_map_sans_antarctica</code> shapefile data we were using earlier. To do this we’ll use a function named <code>left_join()</code>. We feed two data frames into <code>left_join()</code>, and R will keep all the rows from the first and include all the columns from both the first and the second wherever the two datasets match with one specific column. That’s wordy and weird—<a href="https://github.com/gadenbuie/tidyexplain#left-join">stare at this animation here</a> for a few seconds to see what’s really going to happen. We’re essentially going to append the World Bank data to the end of the world shapefiles and line up rows that have matching ISO3 codes. The ISO3 column is named <code>ISO_A3</code> in the shapefile data, and it’s named <code>iso3c</code> in the WDI data, so we tell <code>left_join()</code> that those are the same column:</p>
<div class="cell" data-layout-align="center">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>world_map_with_life_expectancy <span class="ot">&lt;-</span> world_sans_antarctica <span class="sc">|&gt;</span> </span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(wdi_clean_small, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"ISO_A3"</span> <span class="ot">=</span> <span class="st">"iso3c"</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<p>If you look at this dataset in RStudio now and look at the last column, you’ll see the WDI life expectancy right next to the magic <code>geometry</code> column.</p>
<p>We technically didn’t need to shrink the WDI data down to just two columns—had we left everything else, all the WDI columns would have come over to the <code>world_sans_antarctica</code>, including columns for region and income level, etc. But I generally find it easier and cleaner to only merge in the columns I care about instead of making massive datasets with a billion extra columns.</p>
<p>Now that we have a column for life expectancy, we can map it to the fill aesthetic and fill each country by 2015 life expectancy:</p>
<div class="cell" data-layout-align="center">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> world_map_with_life_expectancy, </span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>          <span class="fu">aes</span>(<span class="at">fill =</span> life_expectancy),</span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">linewidth =</span> <span class="fl">0.25</span>) <span class="sc">+</span></span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf</span>(<span class="at">crs =</span> <span class="fu">st_crs</span>(<span class="st">"ESRI:54030"</span>)) <span class="sc">+</span>  <span class="co"># Robinson</span></span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_c</span>(<span class="at">option =</span> <span class="st">"viridis"</span>) <span class="sc">+</span></span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">fill =</span> <span class="st">"Life expectancy"</span>) <span class="sc">+</span></span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="12-example_files/figure-html/world-life-exp-2015-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="960"></p>
</figure>
</div>
</div>
</div>
<p>Voila! Global life expectancy in 2015!</p>
<hr>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Tip</span>France and Norway
</div>
</div>
<div class="callout-body-container callout-body">
<p>Sharp-eyed readers will notice that France and Norway are grayed out because they’re missing data. That’s because the <code>ISO_A3</code> code in the Natural Earth data is missing for both France and Norway for whatever reason, so the WDI data didn’t merge with those rows. To fix that, we can do some manual recoding before joining in the WDI data.</p>
</div>
</div>
<div class="cell" data-layout-align="center">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>world_sans_antarctica_fixed <span class="ot">&lt;-</span> world_sans_antarctica <span class="sc">|&gt;</span> </span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ISO_A3 =</span> <span class="fu">case_when</span>(</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># If the country name is Norway or France, redo the ISO3 code</span></span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>    ADMIN <span class="sc">==</span> <span class="st">"Norway"</span> <span class="sc">~</span> <span class="st">"NOR"</span>,</span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>    ADMIN <span class="sc">==</span> <span class="st">"France"</span> <span class="sc">~</span> <span class="st">"FRA"</span>,</span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Otherwise use the existing ISO3 code</span></span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> ISO_A3</span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">|&gt;</span> </span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(wdi_clean_small, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"ISO_A3"</span> <span class="ot">=</span> <span class="st">"iso3c"</span>))</span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-11"><a href="#cb50-11" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb50-12"><a href="#cb50-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> world_sans_antarctica_fixed, </span>
<span id="cb50-13"><a href="#cb50-13" aria-hidden="true" tabindex="-1"></a>          <span class="fu">aes</span>(<span class="at">fill =</span> life_expectancy),</span>
<span id="cb50-14"><a href="#cb50-14" aria-hidden="true" tabindex="-1"></a>          <span class="at">linewidth =</span> <span class="fl">0.25</span>) <span class="sc">+</span></span>
<span id="cb50-15"><a href="#cb50-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf</span>(<span class="at">crs =</span> <span class="fu">st_crs</span>(<span class="st">"ESRI:54030"</span>)) <span class="sc">+</span>  <span class="co"># Robinson</span></span>
<span id="cb50-16"><a href="#cb50-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_c</span>(<span class="at">option =</span> <span class="st">"viridis"</span>) <span class="sc">+</span></span>
<span id="cb50-17"><a href="#cb50-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">fill =</span> <span class="st">"Life expectancy"</span>) <span class="sc">+</span></span>
<span id="cb50-18"><a href="#cb50-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb50-19"><a href="#cb50-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="12-example_files/figure-html/world-life-exp-2015-fixed-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="960"></p>
</figure>
</div>
</div>
</div>


<!-- -->

</section>


<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>This is essentially the <a href="https://en.wikipedia.org/wiki/Gall%E2%80%93Peters_projection">Gall-Peters projection</a> from <a href="https://www.youtube.com/watch?v=vVX-PrBRtTY">the West Wing clip</a>.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
    const viewSource = window.document.getElementById('quarto-view-source') ||
                       window.document.getElementById('quarto-code-tools-source');
    if (viewSource) {
      const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
      viewSource.addEventListener("click", function(e) {
        if (sourceUrl) {
          // rstudio viewer pane
          if (/\bcapabilities=\b/.test(window.location)) {
            window.open(sourceUrl);
          } else {
            window.location.href = sourceUrl;
          }
        } else {
          const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
          modal.show();
        }
        return false;
      });
    }
    function toggleCodeHandler(show) {
      return function(e) {
        const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
        for (let i=0; i<detailsSrc.length; i++) {
          const details = detailsSrc[i].parentElement;
          if (show) {
            details.open = true;
          } else {
            details.removeAttribute("open");
          }
        }
        const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
        const fromCls = show ? "hidden" : "unhidden";
        const toCls = show ? "unhidden" : "hidden";
        for (let i=0; i<cellCodeDivs.length; i++) {
          const codeDiv = cellCodeDivs[i];
          if (codeDiv.classList.contains(fromCls)) {
            codeDiv.classList.remove(fromCls);
            codeDiv.classList.add(toCls);
          } 
        }
        return false;
      }
    }
    const hideAllCode = window.document.getElementById("quarto-hide-all-code");
    if (hideAllCode) {
      hideAllCode.addEventListener("click", toggleCodeHandler(false));
    }
    const showAllCode = window.document.getElementById("quarto-show-all-code");
    if (showAllCode) {
      showAllCode.addEventListener("click", toggleCodeHandler(true));
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/timmarchand\.github\.io\/ISS_dataviz\/");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../example/11-example.html" class="pagination-link" aria-label="11: Interactivity">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">11: Interactivity</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../example/13-example.html" class="pagination-link" aria-label="13: Time">
        <span class="nav-page-text">13: Time</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb51" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Space"</span></span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a><span class="an">date:</span><span class="co"> "2026-04-06"</span></span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a><span class="an">date_end:</span><span class="co"> "2026-04-10"</span></span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a><span class="in">```{r load-targets, include=FALSE}</span></span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a>withr<span class="sc">::</span><span class="fu">with_dir</span>(here<span class="sc">::</span><span class="fu">here</span>(), {</span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a>  geocoded_path <span class="ot">&lt;-</span> targets<span class="sc">::</span><span class="fu">tar_read</span>(data_geocoded)</span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a>  wdi_path <span class="ot">&lt;-</span> targets<span class="sc">::</span><span class="fu">tar_read</span>(data_wdi_lifeexp)</span>
<span id="cb51-11"><a href="#cb51-11" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb51-12"><a href="#cb51-12" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-13"><a href="#cb51-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-14"><a href="#cb51-14" aria-hidden="true" tabindex="-1"></a><span class="fu">## Shapefiles</span></span>
<span id="cb51-15"><a href="#cb51-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-16"><a href="#cb51-16" aria-hidden="true" tabindex="-1"></a>Shapefiles are special types of data that include information about geography, such as points (latitude, longitude), paths (a bunch of connected latitudes and longitudes) and areas (a bunch of connected latitudes and longitudes that form a complete shape). Nowadays, most government agencies provide shapefiles for their jurisdictions. For global mapping data, you can use the Natural Earth project:</span>
<span id="cb51-17"><a href="#cb51-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-18"><a href="#cb51-18" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">Natural Earth</span><span class="co">](https://www.naturalearthdata.com/)</span></span>
<span id="cb51-19"><a href="#cb51-19" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">US Census Bureau</span><span class="co">](https://www.census.gov/geographies/mapping-files/time-series/geo/cartographic-boundary.html)</span></span>
<span id="cb51-20"><a href="#cb51-20" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">Georgia GIS Clearinghouse</span><span class="co">](https://data.georgiaspatial.org/)</span> (requires a free account; the interface is *incredibly* clunky)</span>
<span id="cb51-21"><a href="#cb51-21" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">Atlanta Regional Council</span><span class="co">](https://opendata.atlantaregional.com/)</span></span>
<span id="cb51-22"><a href="#cb51-22" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">Fulton County GIS Portal</span><span class="co">](https://gisdata.fultoncountyga.gov/)</span></span>
<span id="cb51-23"><a href="#cb51-23" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">City of Atlanta, Department of City Planning</span><span class="co">](https://dcp-coaplangis.opendata.arcgis.com/)</span></span>
<span id="cb51-24"><a href="#cb51-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-25"><a href="#cb51-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-26"><a href="#cb51-26" aria-hidden="true" tabindex="-1"></a><span class="fu">## Projections and coordinate reference systems</span></span>
<span id="cb51-27"><a href="#cb51-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-28"><a href="#cb51-28" aria-hidden="true" tabindex="-1"></a>As you read in this week's readings, projections matter a lot for maps. You can convert your geographic data between different coordinate systems (or projections) fairly easily with {sf}. You can use <span class="in">`coord_sf(crs = st_crs("XXXX"))`</span> to convert coordinate reference systems (CRS) as you plot, or use <span class="in">`st_transform()`</span> to convert data frames to a different CRS.</span>
<span id="cb51-29"><a href="#cb51-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-30"><a href="#cb51-30" aria-hidden="true" tabindex="-1"></a>::: {.callout-note}</span>
<span id="cb51-31"><a href="#cb51-31" aria-hidden="true" tabindex="-1"></a><span class="fu">### Not 100% correct</span></span>
<span id="cb51-32"><a href="#cb51-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-33"><a href="#cb51-33" aria-hidden="true" tabindex="-1"></a>TECHNICALLY coordinate systems and projection systems <span class="co">[</span><span class="ot">are different things</span><span class="co">](https://gis.stackexchange.com/a/149751/56265)</span>, but I'm not a geographer and I don't care that much about the nuance.</span>
<span id="cb51-34"><a href="#cb51-34" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb51-35"><a href="#cb51-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-36"><a href="#cb51-36" aria-hidden="true" tabindex="-1"></a>There are standard indexes of more than 4,000 of these projections (!!!) at <span class="co">[</span><span class="ot">epsg.io</span><span class="co">](https://epsg.io/)</span>. </span>
<span id="cb51-37"><a href="#cb51-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-38"><a href="#cb51-38" aria-hidden="true" tabindex="-1"></a>**Super important**: When using these projections, you need to specify both the projection catalog (ESRI or EPSG; <span class="co">[</span><span class="ot">see here for the difference</span><span class="co">](https://gis.stackexchange.com/a/169211/56265)</span>) and the projection number, separated by a colon (e.g. "<span class="in">`ESRI:54030`</span>"). Fortunately <span class="co">[</span><span class="ot">epsg.io</span><span class="co">](http://epsg.io/)</span> makes this super easy: go to the epsg.io page for the projection you want to use and the page title will have the correct name. </span>
<span id="cb51-39"><a href="#cb51-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-40"><a href="#cb51-40" aria-hidden="true" tabindex="-1"></a>Here are some common ones:</span>
<span id="cb51-41"><a href="#cb51-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-42"><a href="#cb51-42" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">ESRI:54002</span><span class="co">](http://epsg.io/54002)</span>: Equidistant cylindrical projection for the world<span class="ot">[^gall-peters]</span></span>
<span id="cb51-43"><a href="#cb51-43" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">EPSG:3395</span><span class="co">](http://epsg.io/3395)</span>: Mercator projection for the world</span>
<span id="cb51-44"><a href="#cb51-44" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">ESRI:54008</span><span class="co">](http://epsg.io/54008)</span>: Sinusoidal projection for the world</span>
<span id="cb51-45"><a href="#cb51-45" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">ESRI:54009</span><span class="co">](http://epsg.io/54009)</span>: Mollweide projection for the world</span>
<span id="cb51-46"><a href="#cb51-46" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">ESRI:54030</span><span class="co">](http://epsg.io/54030)</span>: Robinson projection for the world (This is my favorite world projection.)</span>
<span id="cb51-47"><a href="#cb51-47" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">EPSG:4326</span><span class="co">](http://epsg.io/4326)</span>: WGS 84: DOD GPS coordinates (standard −180 to 180 system)</span>
<span id="cb51-48"><a href="#cb51-48" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">EPSG:4269</span><span class="co">](http://epsg.io/4269)</span>: NAD 83: Relatively common projection for North America</span>
<span id="cb51-49"><a href="#cb51-49" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">ESRI:102003</span><span class="co">](https://epsg.io/102003)</span>: Albers projection specifically for the contiguous United States</span>
<span id="cb51-50"><a href="#cb51-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-51"><a href="#cb51-51" aria-hidden="true" tabindex="-1"></a><span class="ot">[^gall-peters]: </span>This is essentially the <span class="co">[</span><span class="ot">Gall-Peters projection</span><span class="co">](https://en.wikipedia.org/wiki/Gall%E2%80%93Peters_projection)</span> from <span class="co">[</span><span class="ot">the West Wing clip</span><span class="co">](https://www.youtube.com/watch?v=vVX-PrBRtTY)</span>.</span>
<span id="cb51-52"><a href="#cb51-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-53"><a href="#cb51-53" aria-hidden="true" tabindex="-1"></a>Alternatively, instead of using these index numbers, you can use any of the names listed <span class="co">[</span><span class="ot">here</span><span class="co">](https://proj.org/operations/projections/index.html)</span>, such as:</span>
<span id="cb51-54"><a href="#cb51-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-55"><a href="#cb51-55" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`"+proj=merc"`</span>: Mercator</span>
<span id="cb51-56"><a href="#cb51-56" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`"+proj=robin"`</span>: Robinson</span>
<span id="cb51-57"><a href="#cb51-57" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`"+proj=moll"`</span>: Mollweide </span>
<span id="cb51-58"><a href="#cb51-58" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`"+proj=aeqd"`</span>: Azimuthal Equidistant</span>
<span id="cb51-59"><a href="#cb51-59" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`"+proj=cass"`</span>: Cassini-Soldner</span>
<span id="cb51-60"><a href="#cb51-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-61"><a href="#cb51-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-62"><a href="#cb51-62" aria-hidden="true" tabindex="-1"></a><span class="fu">## Shapefiles to download</span></span>
<span id="cb51-63"><a href="#cb51-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-64"><a href="#cb51-64" aria-hidden="true" tabindex="-1"></a>I use a lot of different shapefiles in this example. To save you from having to go find and download each individual one, you can download this zip file:</span>
<span id="cb51-65"><a href="#cb51-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-66"><a href="#cb51-66" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">{{&lt; fa file-archive &gt;}} `shapefiles.zip`</span><span class="co">](/files/data/external_data/shapefiles.zip)</span></span>
<span id="cb51-67"><a href="#cb51-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-68"><a href="#cb51-68" aria-hidden="true" tabindex="-1"></a>Unzip this and put all the contained folders in a folder named <span class="in">`data`</span> if you want to follow along. **You don't need to follow along!**</span>
<span id="cb51-69"><a href="#cb51-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-70"><a href="#cb51-70" aria-hidden="true" tabindex="-1"></a>Your project should be structured like this:</span>
<span id="cb51-71"><a href="#cb51-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-72"><a href="#cb51-72" aria-hidden="true" tabindex="-1"></a><span class="in">```default</span></span>
<span id="cb51-73"><a href="#cb51-73" aria-hidden="true" tabindex="-1"></a><span class="in">your-project-name\</span></span>
<span id="cb51-74"><a href="#cb51-74" aria-hidden="true" tabindex="-1"></a><span class="in">  some-name.qmd</span></span>
<span id="cb51-75"><a href="#cb51-75" aria-hidden="true" tabindex="-1"></a><span class="in">  your-project-name.Rproj</span></span>
<span id="cb51-76"><a href="#cb51-76" aria-hidden="true" tabindex="-1"></a><span class="in">  data\</span></span>
<span id="cb51-77"><a href="#cb51-77" aria-hidden="true" tabindex="-1"></a><span class="in">    cb_2022_us_county_5m\</span></span>
<span id="cb51-78"><a href="#cb51-78" aria-hidden="true" tabindex="-1"></a><span class="in">      ...</span></span>
<span id="cb51-79"><a href="#cb51-79" aria-hidden="true" tabindex="-1"></a><span class="in">      cb_2022_us_county_5m.shp</span></span>
<span id="cb51-80"><a href="#cb51-80" aria-hidden="true" tabindex="-1"></a><span class="in">      ...</span></span>
<span id="cb51-81"><a href="#cb51-81" aria-hidden="true" tabindex="-1"></a><span class="in">    cb_2022_us_state_20m\</span></span>
<span id="cb51-82"><a href="#cb51-82" aria-hidden="true" tabindex="-1"></a><span class="in">    ne_10m_admin_1_states_provinces\</span></span>
<span id="cb51-83"><a href="#cb51-83" aria-hidden="true" tabindex="-1"></a><span class="in">    ne_10m_lakes\</span></span>
<span id="cb51-84"><a href="#cb51-84" aria-hidden="true" tabindex="-1"></a><span class="in">    ne_10m_rivers_lake_centerlines\</span></span>
<span id="cb51-85"><a href="#cb51-85" aria-hidden="true" tabindex="-1"></a><span class="in">    ne_10m_rivers_north_america\</span></span>
<span id="cb51-86"><a href="#cb51-86" aria-hidden="true" tabindex="-1"></a><span class="in">    ne_110m_admin_0_countries\</span></span>
<span id="cb51-87"><a href="#cb51-87" aria-hidden="true" tabindex="-1"></a><span class="in">    schools_2009\</span></span>
<span id="cb51-88"><a href="#cb51-88" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-89"><a href="#cb51-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-90"><a href="#cb51-90" aria-hidden="true" tabindex="-1"></a>These shapefiles all came from these sources:</span>
<span id="cb51-91"><a href="#cb51-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-92"><a href="#cb51-92" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>{{&lt; fa map &gt;}} **World map**: <span class="co">[</span><span class="ot">110m "Admin 0 - Countries" from Natural Earth</span><span class="co">](https://www.naturalearthdata.com/downloads/110m-cultural-vectors/)</span></span>
<span id="cb51-93"><a href="#cb51-93" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>{{&lt; fa map &gt;}} **US states**: <span class="co">[</span><span class="ot">20m 2022 state boundaries from the US Census Bureau</span><span class="co">](https://www.census.gov/geographies/mapping-files/time-series/geo/cartographic-boundary.html)</span></span>
<span id="cb51-94"><a href="#cb51-94" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>{{&lt; fa map &gt;}} **US counties**: <span class="co">[</span><span class="ot">5m 2022 county boundaries from the US Census Bureau</span><span class="co">](https://www.census.gov/geographies/mapping-files/time-series/geo/cartographic-boundary.html)</span></span>
<span id="cb51-95"><a href="#cb51-95" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>{{&lt; fa map &gt;}} **US states high resolution**: <span class="co">[</span><span class="ot">10m "Admin 1 – States, Provinces" from Natural Earth</span><span class="co">](https://www.naturalearthdata.com/downloads/10m-cultural-vectors/)</span></span>
<span id="cb51-96"><a href="#cb51-96" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>{{&lt; fa map &gt;}} **Global rivers**: <span class="co">[</span><span class="ot">10m "Rivers + lake centerlines" from Natural Earth</span><span class="co">](https://www.naturalearthdata.com/downloads/10m-cultural-vectors/)</span></span>
<span id="cb51-97"><a href="#cb51-97" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>{{&lt; fa map &gt;}} **North American rivers**: <span class="co">[</span><span class="ot">10m "Rivers + lake centerlines, North America supplement" from Natural Earth</span><span class="co">](https://www.naturalearthdata.com/downloads/10m-physical-vectors/)</span></span>
<span id="cb51-98"><a href="#cb51-98" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>{{&lt; fa map &gt;}} **Global lakes**: <span class="co">[</span><span class="ot">10m "Lakes + Reservoirs" from Natural Earth</span><span class="co">](https://www.naturalearthdata.com/downloads/10m-physical-vectors/)</span></span>
<span id="cb51-99"><a href="#cb51-99" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>{{&lt; fa map &gt;}} **Georgia K–12 schools, 2009**: <span class="co">[</span><span class="ot">"Georgia K-12 Schools" from the Georgia Department of Education</span><span class="co">](https://data.georgiaspatial.org/index.asp?body=preview&amp;dataId=41516)</span> *(you must be logged in to access this)*</span>
<span id="cb51-100"><a href="#cb51-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-101"><a href="#cb51-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-102"><a href="#cb51-102" aria-hidden="true" tabindex="-1"></a><span class="fu">## Live coding example</span></span>
<span id="cb51-103"><a href="#cb51-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-104"><a href="#cb51-104" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">div</span><span class="ot"> class</span><span class="op">=</span><span class="st">"ratio ratio-16x9"</span><span class="dt">&gt;</span></span>
<span id="cb51-105"><a href="#cb51-105" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">iframe</span><span class="ot"> src</span><span class="op">=</span><span class="st">"https://www.youtube.com/embed/Opzwtegvuv4"</span><span class="ot"> allow</span><span class="op">=</span><span class="st">"accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture"</span><span class="ot"> allowfullscreen</span><span class="op">=</span><span class="st">""</span><span class="ot"> frameborder</span><span class="op">=</span><span class="st">"0"</span><span class="dt">&gt;&lt;/</span><span class="kw">iframe</span><span class="dt">&gt;</span></span>
<span id="cb51-106"><a href="#cb51-106" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;/</span><span class="kw">div</span><span class="dt">&gt;</span></span>
<span id="cb51-107"><a href="#cb51-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-108"><a href="#cb51-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-109"><a href="#cb51-109" aria-hidden="true" tabindex="-1"></a>::: {.callout-important}</span>
<span id="cb51-110"><a href="#cb51-110" aria-hidden="true" tabindex="-1"></a><span class="fu">### Slight differences from the video</span></span>
<span id="cb51-111"><a href="#cb51-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-112"><a href="#cb51-112" aria-hidden="true" tabindex="-1"></a>This is a slightly cleaned up version of the code from the video.</span>
<span id="cb51-113"><a href="#cb51-113" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb51-114"><a href="#cb51-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-115"><a href="#cb51-115" aria-hidden="true" tabindex="-1"></a><span class="in">```{r setup, include=FALSE}</span></span>
<span id="cb51-116"><a href="#cb51-116" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span>opts_chunk<span class="sc">$</span><span class="fu">set</span>(<span class="at">fig.width =</span> <span class="dv">6</span>, <span class="at">fig.height =</span> <span class="fl">3.6</span>, <span class="at">fig.align =</span> <span class="st">"center"</span>, <span class="at">collapse =</span> <span class="cn">TRUE</span>)</span>
<span id="cb51-117"><a href="#cb51-117" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb51-118"><a href="#cb51-118" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="st">"digits"</span> <span class="ot">=</span> <span class="dv">2</span>, <span class="st">"width"</span> <span class="ot">=</span> <span class="dv">150</span>)</span>
<span id="cb51-119"><a href="#cb51-119" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-120"><a href="#cb51-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-121"><a href="#cb51-121" aria-hidden="true" tabindex="-1"></a><span class="fu">## Load and look at data</span></span>
<span id="cb51-122"><a href="#cb51-122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-123"><a href="#cb51-123" aria-hidden="true" tabindex="-1"></a>First we'll load the libraries we're going to use:</span>
<span id="cb51-124"><a href="#cb51-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-125"><a href="#cb51-125" aria-hidden="true" tabindex="-1"></a><span class="in">```{r load-libraries, message=FALSE, warning=FALSE}</span></span>
<span id="cb51-126"><a href="#cb51-126" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)  <span class="co"># For ggplot, dplyr, and friends</span></span>
<span id="cb51-127"><a href="#cb51-127" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)         <span class="co"># For GIS magic</span></span>
<span id="cb51-128"><a href="#cb51-128" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-129"><a href="#cb51-129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-130"><a href="#cb51-130" aria-hidden="true" tabindex="-1"></a>Next we'll load all the different shapefiles we downloaded using <span class="in">`read_sf()`</span>: </span>
<span id="cb51-131"><a href="#cb51-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-132"><a href="#cb51-132" aria-hidden="true" tabindex="-1"></a><span class="in">```{r load-shapefiles-fake, eval=FALSE}</span></span>
<span id="cb51-133"><a href="#cb51-133" aria-hidden="true" tabindex="-1"></a><span class="co"># Download "Admin 0 – Countries" from</span></span>
<span id="cb51-134"><a href="#cb51-134" aria-hidden="true" tabindex="-1"></a><span class="co"># https://www.naturalearthdata.com/downloads/110m-cultural-vectors/</span></span>
<span id="cb51-135"><a href="#cb51-135" aria-hidden="true" tabindex="-1"></a>world_map <span class="ot">&lt;-</span> <span class="fu">read_sf</span>(<span class="st">"data/ne_110m_admin_0_countries/ne_110m_admin_0_countries.shp"</span>)</span>
<span id="cb51-136"><a href="#cb51-136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-137"><a href="#cb51-137" aria-hidden="true" tabindex="-1"></a><span class="co"># Download cb_2022_us_state_20m.zip under "States" from</span></span>
<span id="cb51-138"><a href="#cb51-138" aria-hidden="true" tabindex="-1"></a><span class="co"># https://www.census.gov/geographies/mapping-files/time-series/geo/cartographic-boundary.html</span></span>
<span id="cb51-139"><a href="#cb51-139" aria-hidden="true" tabindex="-1"></a>us_states <span class="ot">&lt;-</span> <span class="fu">read_sf</span>(<span class="st">"data/cb_2022_us_state_20m/cb_2022_us_state_20m.shp"</span>)</span>
<span id="cb51-140"><a href="#cb51-140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-141"><a href="#cb51-141" aria-hidden="true" tabindex="-1"></a><span class="co"># Download cb_2022_us_county_5m.zip under "County" from</span></span>
<span id="cb51-142"><a href="#cb51-142" aria-hidden="true" tabindex="-1"></a><span class="co"># https://www.census.gov/geographies/mapping-files/time-series/geo/cartographic-boundary.html</span></span>
<span id="cb51-143"><a href="#cb51-143" aria-hidden="true" tabindex="-1"></a>us_counties <span class="ot">&lt;-</span> <span class="fu">read_sf</span>(<span class="st">"data/cb_2022_us_county_5m/cb_2022_us_county_5m.shp"</span>)</span>
<span id="cb51-144"><a href="#cb51-144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-145"><a href="#cb51-145" aria-hidden="true" tabindex="-1"></a><span class="co"># Download "Admin 1 – States, Provinces" from</span></span>
<span id="cb51-146"><a href="#cb51-146" aria-hidden="true" tabindex="-1"></a><span class="co"># https://www.naturalearthdata.com/downloads/10m-cultural-vectors/</span></span>
<span id="cb51-147"><a href="#cb51-147" aria-hidden="true" tabindex="-1"></a>us_states_hires <span class="ot">&lt;-</span> <span class="fu">read_sf</span>(<span class="st">"data/ne_10m_admin_1_states_provinces/ne_10m_admin_1_states_provinces.shp"</span>)</span>
<span id="cb51-148"><a href="#cb51-148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-149"><a href="#cb51-149" aria-hidden="true" tabindex="-1"></a><span class="co"># Download "Rivers + lake centerlines" from</span></span>
<span id="cb51-150"><a href="#cb51-150" aria-hidden="true" tabindex="-1"></a><span class="co"># https://www.naturalearthdata.com/downloads/10m-physical-vectors/</span></span>
<span id="cb51-151"><a href="#cb51-151" aria-hidden="true" tabindex="-1"></a>rivers_global <span class="ot">&lt;-</span> <span class="fu">read_sf</span>(<span class="st">"data/ne_10m_rivers_lake_centerlines/ne_10m_rivers_lake_centerlines.shp"</span>)</span>
<span id="cb51-152"><a href="#cb51-152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-153"><a href="#cb51-153" aria-hidden="true" tabindex="-1"></a><span class="co"># Download "Rivers + lake centerlines, North America supplement" from</span></span>
<span id="cb51-154"><a href="#cb51-154" aria-hidden="true" tabindex="-1"></a><span class="co"># https://www.naturalearthdata.com/downloads/10m-physical-vectors/</span></span>
<span id="cb51-155"><a href="#cb51-155" aria-hidden="true" tabindex="-1"></a>rivers_na <span class="ot">&lt;-</span> <span class="fu">read_sf</span>(<span class="st">"data/ne_10m_rivers_north_america/ne_10m_rivers_north_america.shp"</span>)</span>
<span id="cb51-156"><a href="#cb51-156" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-157"><a href="#cb51-157" aria-hidden="true" tabindex="-1"></a><span class="co"># Download "Lakes + Reservoirs" from</span></span>
<span id="cb51-158"><a href="#cb51-158" aria-hidden="true" tabindex="-1"></a><span class="co"># https://www.naturalearthdata.com/downloads/10m-physical-vectors/</span></span>
<span id="cb51-159"><a href="#cb51-159" aria-hidden="true" tabindex="-1"></a>lakes <span class="ot">&lt;-</span> <span class="fu">read_sf</span>(<span class="st">"data/ne_10m_lakes/ne_10m_lakes.shp"</span>)</span>
<span id="cb51-160"><a href="#cb51-160" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-161"><a href="#cb51-161" aria-hidden="true" tabindex="-1"></a><span class="co"># Download from https://data.georgiaspatial.org/index.asp?body=preview&amp;dataId=41516</span></span>
<span id="cb51-162"><a href="#cb51-162" aria-hidden="true" tabindex="-1"></a><span class="co"># after creating an account and logging in</span></span>
<span id="cb51-163"><a href="#cb51-163" aria-hidden="true" tabindex="-1"></a>ga_schools <span class="ot">&lt;-</span> <span class="fu">read_sf</span>(<span class="st">"data/schools_2009/DOE Schools 2009.shp"</span>)</span>
<span id="cb51-164"><a href="#cb51-164" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-165"><a href="#cb51-165" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-166"><a href="#cb51-166" aria-hidden="true" tabindex="-1"></a><span class="in">```{r load-shapefiles-real, include=FALSE}</span></span>
<span id="cb51-167"><a href="#cb51-167" aria-hidden="true" tabindex="-1"></a>world_map <span class="ot">&lt;-</span> <span class="fu">read_sf</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"files"</span>, <span class="st">"data"</span>, <span class="st">"external_data"</span>, <span class="st">"maps"</span>,</span>
<span id="cb51-168"><a href="#cb51-168" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"ne_110m_admin_0_countries"</span>, </span>
<span id="cb51-169"><a href="#cb51-169" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"ne_110m_admin_0_countries.shp"</span>))</span>
<span id="cb51-170"><a href="#cb51-170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-171"><a href="#cb51-171" aria-hidden="true" tabindex="-1"></a>us_states <span class="ot">&lt;-</span> <span class="fu">read_sf</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"files"</span>, <span class="st">"data"</span>, <span class="st">"external_data"</span>, <span class="st">"maps"</span>,</span>
<span id="cb51-172"><a href="#cb51-172" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"cb_2022_us_state_20m"</span>,</span>
<span id="cb51-173"><a href="#cb51-173" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"cb_2022_us_state_20m.shp"</span>))</span>
<span id="cb51-174"><a href="#cb51-174" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-175"><a href="#cb51-175" aria-hidden="true" tabindex="-1"></a>us_states_hires <span class="ot">&lt;-</span> <span class="fu">read_sf</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"files"</span>, <span class="st">"data"</span>, <span class="st">"external_data"</span>, <span class="st">"maps"</span>,</span>
<span id="cb51-176"><a href="#cb51-176" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">"ne_10m_admin_1_states_provinces"</span>,</span>
<span id="cb51-177"><a href="#cb51-177" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">"ne_10m_admin_1_states_provinces.shp"</span>))</span>
<span id="cb51-178"><a href="#cb51-178" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-179"><a href="#cb51-179" aria-hidden="true" tabindex="-1"></a>us_counties <span class="ot">&lt;-</span> <span class="fu">read_sf</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"files"</span>, <span class="st">"data"</span>, <span class="st">"external_data"</span>, <span class="st">"maps"</span>,</span>
<span id="cb51-180"><a href="#cb51-180" aria-hidden="true" tabindex="-1"></a>                                  <span class="st">"cb_2022_us_county_5m"</span>,</span>
<span id="cb51-181"><a href="#cb51-181" aria-hidden="true" tabindex="-1"></a>                                  <span class="st">"cb_2022_us_county_5m.shp"</span>))</span>
<span id="cb51-182"><a href="#cb51-182" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-183"><a href="#cb51-183" aria-hidden="true" tabindex="-1"></a>rivers_global <span class="ot">&lt;-</span> <span class="fu">read_sf</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"files"</span>, <span class="st">"data"</span>, <span class="st">"external_data"</span>, <span class="st">"maps"</span>,</span>
<span id="cb51-184"><a href="#cb51-184" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">"ne_10m_rivers_lake_centerlines"</span>,</span>
<span id="cb51-185"><a href="#cb51-185" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">"ne_10m_rivers_lake_centerlines.shp"</span>))</span>
<span id="cb51-186"><a href="#cb51-186" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-187"><a href="#cb51-187" aria-hidden="true" tabindex="-1"></a>rivers_na <span class="ot">&lt;-</span> <span class="fu">read_sf</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"files"</span>, <span class="st">"data"</span>, <span class="st">"external_data"</span>, <span class="st">"maps"</span>,</span>
<span id="cb51-188"><a href="#cb51-188" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"ne_10m_rivers_north_america"</span>,</span>
<span id="cb51-189"><a href="#cb51-189" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"ne_10m_rivers_north_america.shp"</span>))</span>
<span id="cb51-190"><a href="#cb51-190" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-191"><a href="#cb51-191" aria-hidden="true" tabindex="-1"></a>lakes <span class="ot">&lt;-</span> <span class="fu">read_sf</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"files"</span>, <span class="st">"data"</span>, <span class="st">"external_data"</span>, <span class="st">"maps"</span>,</span>
<span id="cb51-192"><a href="#cb51-192" aria-hidden="true" tabindex="-1"></a>                            <span class="st">"ne_10m_lakes"</span>, <span class="st">"ne_10m_lakes.shp"</span>))</span>
<span id="cb51-193"><a href="#cb51-193" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-194"><a href="#cb51-194" aria-hidden="true" tabindex="-1"></a>ga_schools <span class="ot">&lt;-</span> <span class="fu">read_sf</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"files"</span>, <span class="st">"data"</span>, <span class="st">"external_data"</span>, <span class="st">"maps"</span>,</span>
<span id="cb51-195"><a href="#cb51-195" aria-hidden="true" tabindex="-1"></a>                                 <span class="st">"schools_2009"</span>, <span class="st">"DOE Schools 2009.shp"</span>))</span>
<span id="cb51-196"><a href="#cb51-196" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-197"><a href="#cb51-197" aria-hidden="true" tabindex="-1"></a>geocoded_addresses <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(here<span class="sc">::</span><span class="fu">here</span>(geocoded_path))</span>
<span id="cb51-198"><a href="#cb51-198" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-199"><a href="#cb51-199" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-200"><a href="#cb51-200" aria-hidden="true" tabindex="-1"></a><span class="fu">## Basic plotting</span></span>
<span id="cb51-201"><a href="#cb51-201" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-202"><a href="#cb51-202" aria-hidden="true" tabindex="-1"></a>If you look at the <span class="in">`world_map`</span> dataset in RStudio, you'll see it's just a standard data frame with <span class="in">`r nrow(world_map)`</span> rows and <span class="in">`r ncol(world_map)`</span> columns. The last column is the magical <span class="in">`geometry`</span> column with the latitude/longitude details for the borders for every country. RStudio only shows you 50 columns at a time in the RStudio viewer, so you'll need to move to the next page of columns with the » button in the top left corner.</span>
<span id="cb51-203"><a href="#cb51-203" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-204"><a href="#cb51-204" aria-hidden="true" tabindex="-1"></a>Because this is just a data frame, we can do all our normal dplyr things to it. Let's get rid of Antarctica, since it takes up a big proportion of the southern hemisphere:</span>
<span id="cb51-205"><a href="#cb51-205" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-206"><a href="#cb51-206" aria-hidden="true" tabindex="-1"></a><span class="in">```{r world-sans-ata}</span></span>
<span id="cb51-207"><a href="#cb51-207" aria-hidden="true" tabindex="-1"></a>world_sans_antarctica <span class="ot">&lt;-</span> world_map <span class="sc">|&gt;</span> </span>
<span id="cb51-208"><a href="#cb51-208" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(ISO_A3 <span class="sc">!=</span> <span class="st">"ATA"</span>)</span>
<span id="cb51-209"><a href="#cb51-209" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-210"><a href="#cb51-210" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-211"><a href="#cb51-211" aria-hidden="true" tabindex="-1"></a>Ready to plot a map? Here's all you need to do:</span>
<span id="cb51-212"><a href="#cb51-212" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-213"><a href="#cb51-213" aria-hidden="true" tabindex="-1"></a><span class="in">```{r map-super-basic}</span></span>
<span id="cb51-214"><a href="#cb51-214" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb51-215"><a href="#cb51-215" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> world_sans_antarctica)</span>
<span id="cb51-216"><a href="#cb51-216" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-217"><a href="#cb51-217" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-218"><a href="#cb51-218" aria-hidden="true" tabindex="-1"></a>If you couldn't tell from the lecture, I'm completely blown away by how amazingly easy this every time I plot a map :)</span>
<span id="cb51-219"><a href="#cb51-219" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-220"><a href="#cb51-220" aria-hidden="true" tabindex="-1"></a>Because this a regular ggplot geom, all our regular aesthetics and themes and everything work:</span>
<span id="cb51-221"><a href="#cb51-221" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-222"><a href="#cb51-222" aria-hidden="true" tabindex="-1"></a><span class="in">```{r map-super-basic-filled}</span></span>
<span id="cb51-223"><a href="#cb51-223" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb51-224"><a href="#cb51-224" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> world_sans_antarctica, </span>
<span id="cb51-225"><a href="#cb51-225" aria-hidden="true" tabindex="-1"></a>          <span class="at">fill =</span> <span class="st">"#669438"</span>, <span class="at">color =</span> <span class="st">"#32481B"</span>, <span class="at">linewidth =</span> <span class="fl">0.25</span>) <span class="sc">+</span></span>
<span id="cb51-226"><a href="#cb51-226" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>()</span>
<span id="cb51-227"><a href="#cb51-227" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-228"><a href="#cb51-228" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-229"><a href="#cb51-229" aria-hidden="true" tabindex="-1"></a>The Natural Earth dataset happens to come with some columns with a coloring scheme with 7–13 colors (<span class="in">`MAPCOLOR7`</span>, <span class="in">`MAPCOLOR9`</span>, etc.) so that no countries with a shared border share a color. We can fill by that column:</span>
<span id="cb51-230"><a href="#cb51-230" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-231"><a href="#cb51-231" aria-hidden="true" tabindex="-1"></a><span class="in">```{r map-super-basic-filled-7}</span></span>
<span id="cb51-232"><a href="#cb51-232" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb51-233"><a href="#cb51-233" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> world_sans_antarctica, </span>
<span id="cb51-234"><a href="#cb51-234" aria-hidden="true" tabindex="-1"></a>          <span class="fu">aes</span>(<span class="at">fill =</span> <span class="fu">as.factor</span>(MAPCOLOR7)),</span>
<span id="cb51-235"><a href="#cb51-235" aria-hidden="true" tabindex="-1"></a>          <span class="at">color =</span> <span class="st">"#401D16"</span>, <span class="at">linewidth =</span> <span class="fl">0.25</span>) <span class="sc">+</span></span>
<span id="cb51-236"><a href="#cb51-236" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_d</span>(<span class="at">option =</span> <span class="st">"plasma"</span>) <span class="sc">+</span></span>
<span id="cb51-237"><a href="#cb51-237" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">fill =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb51-238"><a href="#cb51-238" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>()</span>
<span id="cb51-239"><a href="#cb51-239" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-240"><a href="#cb51-240" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-241"><a href="#cb51-241" aria-hidden="true" tabindex="-1"></a><span class="fu">## World map with different projections</span></span>
<span id="cb51-242"><a href="#cb51-242" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-243"><a href="#cb51-243" aria-hidden="true" tabindex="-1"></a>Changing projections is trivial: add a <span class="in">`coord_sf()`</span> layer where you specify the CRS you want to use.</span>
<span id="cb51-244"><a href="#cb51-244" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-245"><a href="#cb51-245" aria-hidden="true" tabindex="-1"></a>Here's Robinson (yay):</span>
<span id="cb51-246"><a href="#cb51-246" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-247"><a href="#cb51-247" aria-hidden="true" tabindex="-1"></a><span class="in">```{r map-basic-robinson}</span></span>
<span id="cb51-248"><a href="#cb51-248" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb51-249"><a href="#cb51-249" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> world_sans_antarctica, </span>
<span id="cb51-250"><a href="#cb51-250" aria-hidden="true" tabindex="-1"></a>          <span class="at">fill =</span> <span class="st">"#669438"</span>, <span class="at">color =</span> <span class="st">"#32481B"</span>, <span class="at">linewidth =</span> <span class="fl">0.25</span>) <span class="sc">+</span></span>
<span id="cb51-251"><a href="#cb51-251" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf</span>(<span class="at">crs =</span> <span class="fu">st_crs</span>(<span class="st">"ESRI:54030"</span>)) <span class="sc">+</span>  <span class="co"># Robinson</span></span>
<span id="cb51-252"><a href="#cb51-252" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Or use the name instead of the number</span></span>
<span id="cb51-253"><a href="#cb51-253" aria-hidden="true" tabindex="-1"></a>  <span class="co"># coord_sf(crs = "+proj=robin")</span></span>
<span id="cb51-254"><a href="#cb51-254" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>()</span>
<span id="cb51-255"><a href="#cb51-255" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-256"><a href="#cb51-256" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-257"><a href="#cb51-257" aria-hidden="true" tabindex="-1"></a>Here's sinusoidal:</span>
<span id="cb51-258"><a href="#cb51-258" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-259"><a href="#cb51-259" aria-hidden="true" tabindex="-1"></a><span class="in">```{r map-basic-sinusoidal}</span></span>
<span id="cb51-260"><a href="#cb51-260" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb51-261"><a href="#cb51-261" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> world_sans_antarctica, </span>
<span id="cb51-262"><a href="#cb51-262" aria-hidden="true" tabindex="-1"></a>          <span class="at">fill =</span> <span class="st">"#669438"</span>, <span class="at">color =</span> <span class="st">"#32481B"</span>, <span class="at">linewidth =</span> <span class="fl">0.25</span>) <span class="sc">+</span></span>
<span id="cb51-263"><a href="#cb51-263" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf</span>(<span class="at">crs =</span> <span class="fu">st_crs</span>(<span class="st">"ESRI:54008"</span>)) <span class="sc">+</span>  <span class="co"># Sinusoidal</span></span>
<span id="cb51-264"><a href="#cb51-264" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>()</span>
<span id="cb51-265"><a href="#cb51-265" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-266"><a href="#cb51-266" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-267"><a href="#cb51-267" aria-hidden="true" tabindex="-1"></a>And here's Mercator (ewww):</span>
<span id="cb51-268"><a href="#cb51-268" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-269"><a href="#cb51-269" aria-hidden="true" tabindex="-1"></a><span class="in">```{r map-basic-mercator}</span></span>
<span id="cb51-270"><a href="#cb51-270" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb51-271"><a href="#cb51-271" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> world_sans_antarctica, </span>
<span id="cb51-272"><a href="#cb51-272" aria-hidden="true" tabindex="-1"></a>          <span class="at">fill =</span> <span class="st">"#669438"</span>, <span class="at">color =</span> <span class="st">"#32481B"</span>, <span class="at">linewidth =</span> <span class="fl">0.25</span>) <span class="sc">+</span></span>
<span id="cb51-273"><a href="#cb51-273" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf</span>(<span class="at">crs =</span> <span class="fu">st_crs</span>(<span class="st">"EPSG:3395"</span>)) <span class="sc">+</span>  <span class="co"># Mercator</span></span>
<span id="cb51-274"><a href="#cb51-274" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Or use the name instead of the number</span></span>
<span id="cb51-275"><a href="#cb51-275" aria-hidden="true" tabindex="-1"></a>  <span class="co"># coord_sf(crs = "+proj=merc")</span></span>
<span id="cb51-276"><a href="#cb51-276" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>()</span>
<span id="cb51-277"><a href="#cb51-277" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-278"><a href="#cb51-278" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-279"><a href="#cb51-279" aria-hidden="true" tabindex="-1"></a><span class="fu">## US map with different projections</span></span>
<span id="cb51-280"><a href="#cb51-280" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-281"><a href="#cb51-281" aria-hidden="true" tabindex="-1"></a>This same process works for any shapefile. The map of the US can also be projected differently—two common projections are NAD83 and Albers. We'll take the <span class="in">`us_states`</span> dataset, remove Alaska, Hawaii, and Puerto Rico (they're so far from the rest of the lower 48 states that they make an unusable map—see the next section for a way to include them), and plot it.</span>
<span id="cb51-282"><a href="#cb51-282" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-283"><a href="#cb51-283" aria-hidden="true" tabindex="-1"></a><span class="in">```{r us-nad83}</span></span>
<span id="cb51-284"><a href="#cb51-284" aria-hidden="true" tabindex="-1"></a>lower_48 <span class="ot">&lt;-</span> us_states <span class="sc">|&gt;</span> </span>
<span id="cb51-285"><a href="#cb51-285" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>(NAME <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Alaska"</span>, <span class="st">"Hawaii"</span>, <span class="st">"Puerto Rico"</span>)))</span>
<span id="cb51-286"><a href="#cb51-286" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-287"><a href="#cb51-287" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb51-288"><a href="#cb51-288" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> lower_48, <span class="at">fill =</span> <span class="st">"#192DA1"</span>, <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">linewidth =</span> <span class="fl">0.25</span>) <span class="sc">+</span></span>
<span id="cb51-289"><a href="#cb51-289" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf</span>(<span class="at">crs =</span> <span class="fu">st_crs</span>(<span class="st">"EPSG:4269"</span>)) <span class="sc">+</span>  <span class="co"># NAD83</span></span>
<span id="cb51-290"><a href="#cb51-290" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>()</span>
<span id="cb51-291"><a href="#cb51-291" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-292"><a href="#cb51-292" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-293"><a href="#cb51-293" aria-hidden="true" tabindex="-1"></a><span class="in">```{r us-albers}</span></span>
<span id="cb51-294"><a href="#cb51-294" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb51-295"><a href="#cb51-295" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> lower_48, <span class="at">fill =</span> <span class="st">"#192DA1"</span>, <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">linewidth =</span> <span class="fl">0.25</span>) <span class="sc">+</span></span>
<span id="cb51-296"><a href="#cb51-296" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf</span>(<span class="at">crs =</span> <span class="fu">st_crs</span>(<span class="st">"ESRI:102003"</span>)) <span class="sc">+</span>  <span class="co"># Albers</span></span>
<span id="cb51-297"><a href="#cb51-297" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>()</span>
<span id="cb51-298"><a href="#cb51-298" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-299"><a href="#cb51-299" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-300"><a href="#cb51-300" aria-hidden="true" tabindex="-1"></a><span class="fu">## US map with non-continguous parts</span></span>
<span id="cb51-301"><a href="#cb51-301" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-302"><a href="#cb51-302" aria-hidden="true" tabindex="-1"></a>Plotting places like Alaska, Hawaii, and Puerto Rico gets a little tricky since they're far away from the contiguous 48 states. There's an easy way to handle it though!</span>
<span id="cb51-303"><a href="#cb51-303" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-304"><a href="#cb51-304" aria-hidden="true" tabindex="-1"></a>First, there's a package named <span class="co">[</span><span class="ot">{tigris}</span><span class="co">](https://github.com/walkerke/tigris)</span> that provides a neat interface for working with spatial data from the <span class="co">[</span><span class="ot">US Census's TIGER shapefiles</span><span class="co">](https://www.census.gov/geographies/mapping-files/time-series/geo/tiger-line-file.html)</span>. In addition to providing a ton of functions for getting shapefiles for states, counties, voting districts, Tribal areas, military bases, and dozens of other things, {tigris} has a <span class="in">`shift_geometry()`</span> function that will change the coordinates for Alaska, Hawaii, and Puerto Rico so that they end up in Mexico and the Gulf of Mexico.</span>
<span id="cb51-305"><a href="#cb51-305" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-306"><a href="#cb51-306" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-307"><a href="#cb51-307" aria-hidden="true" tabindex="-1"></a><span class="in">```{r tigris-shifting, warning=FALSE, message=FALSE}</span></span>
<span id="cb51-308"><a href="#cb51-308" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tigris)</span>
<span id="cb51-309"><a href="#cb51-309" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-310"><a href="#cb51-310" aria-hidden="true" tabindex="-1"></a><span class="co"># This is the Census shapefile we loaded earlier. Note how we're not filtering</span></span>
<span id="cb51-311"><a href="#cb51-311" aria-hidden="true" tabindex="-1"></a><span class="co"># out AK, HI, and PR now</span></span>
<span id="cb51-312"><a href="#cb51-312" aria-hidden="true" tabindex="-1"></a>us_states_shifted <span class="ot">&lt;-</span> us_states <span class="sc">|&gt;</span> </span>
<span id="cb51-313"><a href="#cb51-313" aria-hidden="true" tabindex="-1"></a>  <span class="fu">shift_geometry</span>()  <span class="co"># Move AK, HI, and PR around</span></span>
<span id="cb51-314"><a href="#cb51-314" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-315"><a href="#cb51-315" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb51-316"><a href="#cb51-316" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> us_states_shifted) <span class="sc">+</span></span>
<span id="cb51-317"><a href="#cb51-317" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf</span>(<span class="at">crs =</span> <span class="fu">st_crs</span>(<span class="st">"ESRI:102003"</span>)) <span class="sc">+</span>  <span class="co"># Albers</span></span>
<span id="cb51-318"><a href="#cb51-318" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>()</span>
<span id="cb51-319"><a href="#cb51-319" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-320"><a href="#cb51-320" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-321"><a href="#cb51-321" aria-hidden="true" tabindex="-1"></a>The <span class="in">`shift_geometry()`</span> function should work on any shapefile. What if you have a shapefile with the coordinates of all public libraries in Alaska? Those will use the actual coordinates, not the shifted-to-Mexico coordinates. Feed that data to <span class="in">`shift_geometry()`</span> and it should translate any coordinates you have in Alaska, Hawaii, and Puerto Rico to the Mexico area so they'll plot correctly.</span>
<span id="cb51-322"><a href="#cb51-322" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-323"><a href="#cb51-323" aria-hidden="true" tabindex="-1"></a><span class="in">`shift_geometry()`</span> has an optional <span class="in">`position`</span> argument that lets you control where the non-contiguous states go. By default they'll go below the continental US (<span class="in">`position = "below"`</span>), but you can also use <span class="in">`position = "outside"`</span> to place them more in relation to where they are in real life:</span>
<span id="cb51-324"><a href="#cb51-324" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-325"><a href="#cb51-325" aria-hidden="true" tabindex="-1"></a><span class="in">```{r tigris-shifting-alt}</span></span>
<span id="cb51-326"><a href="#cb51-326" aria-hidden="true" tabindex="-1"></a>us_states_shifted <span class="ot">&lt;-</span> us_states <span class="sc">|&gt;</span> </span>
<span id="cb51-327"><a href="#cb51-327" aria-hidden="true" tabindex="-1"></a>  <span class="fu">shift_geometry</span>(<span class="at">position =</span> <span class="st">"outside"</span>)</span>
<span id="cb51-328"><a href="#cb51-328" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-329"><a href="#cb51-329" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb51-330"><a href="#cb51-330" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> us_states_shifted) <span class="sc">+</span></span>
<span id="cb51-331"><a href="#cb51-331" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf</span>(<span class="at">crs =</span> <span class="fu">st_crs</span>(<span class="st">"ESRI:102003"</span>)) <span class="sc">+</span>  <span class="co"># Albers</span></span>
<span id="cb51-332"><a href="#cb51-332" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>()</span>
<span id="cb51-333"><a href="#cb51-333" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-334"><a href="#cb51-334" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-335"><a href="#cb51-335" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-336"><a href="#cb51-336" aria-hidden="true" tabindex="-1"></a><span class="fu">## Individual states</span></span>
<span id="cb51-337"><a href="#cb51-337" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-338"><a href="#cb51-338" aria-hidden="true" tabindex="-1"></a>Again, because these shapefiles are really just fancy data frames, we can filter them with normal dplyr functions. Let's plot just Georgia:</span>
<span id="cb51-339"><a href="#cb51-339" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-340"><a href="#cb51-340" aria-hidden="true" tabindex="-1"></a><span class="in">```{r georgia-only}</span></span>
<span id="cb51-341"><a href="#cb51-341" aria-hidden="true" tabindex="-1"></a>only_georgia <span class="ot">&lt;-</span> lower_48 <span class="sc">|&gt;</span> </span>
<span id="cb51-342"><a href="#cb51-342" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(NAME <span class="sc">==</span> <span class="st">"Georgia"</span>)</span>
<span id="cb51-343"><a href="#cb51-343" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-344"><a href="#cb51-344" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb51-345"><a href="#cb51-345" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> only_georgia, <span class="at">fill =</span> <span class="st">"#EC8E55"</span>) <span class="sc">+</span></span>
<span id="cb51-346"><a href="#cb51-346" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>()</span>
<span id="cb51-347"><a href="#cb51-347" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-348"><a href="#cb51-348" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-349"><a href="#cb51-349" aria-hidden="true" tabindex="-1"></a>We can also use a different projection. If we look at <span class="co">[</span><span class="ot">epsg.io</span><span class="co">](http://epsg.io/)</span>, there's <span class="co">[</span><span class="ot">a version of NAD83 that's focused specifically on Georgia</span><span class="co">](http://epsg.io/2239-1713)</span>. </span>
<span id="cb51-350"><a href="#cb51-350" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-351"><a href="#cb51-351" aria-hidden="true" tabindex="-1"></a><span class="in">```{r georgia-only-projection}</span></span>
<span id="cb51-352"><a href="#cb51-352" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb51-353"><a href="#cb51-353" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> only_georgia, <span class="at">fill =</span> <span class="st">"#EC8E55"</span>) <span class="sc">+</span></span>
<span id="cb51-354"><a href="#cb51-354" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb51-355"><a href="#cb51-355" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf</span>(<span class="at">crs =</span> <span class="fu">st_crs</span>(<span class="st">"EPSG:2239"</span>))  <span class="co"># NAD83 focused on Georgia</span></span>
<span id="cb51-356"><a href="#cb51-356" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-357"><a href="#cb51-357" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-358"><a href="#cb51-358" aria-hidden="true" tabindex="-1"></a>There's one small final issue though: we're missing all the Atlantic islands in the southeast like Cumberland Island and Amelia Island. That's because we're using the Census's low resolution (20m) data. That's fine for the map of the whole country, but if we're looking at a single state, we probably want better detail in the borders. We can use the Census's high resolution (500k) data, but even then it doesn't include the islands for whatever reason, but <span class="co">[</span><span class="ot">Natural Earth has high resolution US state data</span><span class="co">](https://www.naturalearthdata.com/downloads/10m-cultural-vectors/10m-admin-1-states-provinces/)</span> that *does* have the islands, so we can use that:</span>
<span id="cb51-359"><a href="#cb51-359" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-360"><a href="#cb51-360" aria-hidden="true" tabindex="-1"></a><span class="in">```{r georgia-only-hires}</span></span>
<span id="cb51-361"><a href="#cb51-361" aria-hidden="true" tabindex="-1"></a>only_georgia_high <span class="ot">&lt;-</span> us_states_hires <span class="sc">|&gt;</span> </span>
<span id="cb51-362"><a href="#cb51-362" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(iso_3166_2 <span class="sc">==</span> <span class="st">"US-GA"</span>)</span>
<span id="cb51-363"><a href="#cb51-363" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-364"><a href="#cb51-364" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb51-365"><a href="#cb51-365" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> only_georgia_high, <span class="at">fill =</span> <span class="st">"#EC8E55"</span>) <span class="sc">+</span></span>
<span id="cb51-366"><a href="#cb51-366" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb51-367"><a href="#cb51-367" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf</span>(<span class="at">crs =</span> <span class="fu">st_crs</span>(<span class="st">"EPSG:2239"</span>))  <span class="co"># NAD83 focused on Georgia</span></span>
<span id="cb51-368"><a href="#cb51-368" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-369"><a href="#cb51-369" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-370"><a href="#cb51-370" aria-hidden="true" tabindex="-1"></a>Perfect.</span>
<span id="cb51-371"><a href="#cb51-371" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-372"><a href="#cb51-372" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-373"><a href="#cb51-373" aria-hidden="true" tabindex="-1"></a><span class="fu">## Plotting multiple shapefile layers</span></span>
<span id="cb51-374"><a href="#cb51-374" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-375"><a href="#cb51-375" aria-hidden="true" tabindex="-1"></a>The state shapefiles from the Census Bureau only include state boundaries. If we want to see counties in Georgia, we need to download and load the Census's county shapefiles (which we did above). We can then add a second <span class="in">`geom_sf()`</span> layer for the counties.</span>
<span id="cb51-376"><a href="#cb51-376" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-377"><a href="#cb51-377" aria-hidden="true" tabindex="-1"></a>First we need to filter the county data to only include Georgia counties. The counties data doesn't include a column with the state name or state abbreviation, but it does include a column named <span class="in">`STATEFP`</span>, which is the <span class="co">[</span><span class="ot">state FIPS code</span><span class="co">](https://en.wikipedia.org/wiki/Federal_Information_Processing_Standard_state_code)</span>. Looking at <span class="in">`lower_48`</span> we can see that the state FIPS code for Georgia is 13, so we use that to filter.</span>
<span id="cb51-378"><a href="#cb51-378" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-379"><a href="#cb51-379" aria-hidden="true" tabindex="-1"></a><span class="in">```{r get-ga-counties}</span></span>
<span id="cb51-380"><a href="#cb51-380" aria-hidden="true" tabindex="-1"></a>ga_counties <span class="ot">&lt;-</span> us_counties <span class="sc">|&gt;</span> </span>
<span id="cb51-381"><a href="#cb51-381" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(STATEFP <span class="sc">==</span> <span class="dv">13</span>)</span>
<span id="cb51-382"><a href="#cb51-382" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-383"><a href="#cb51-383" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-384"><a href="#cb51-384" aria-hidden="true" tabindex="-1"></a>Now we can plot just the counties:</span>
<span id="cb51-385"><a href="#cb51-385" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-386"><a href="#cb51-386" aria-hidden="true" tabindex="-1"></a><span class="in">```{r ga-counties-only}</span></span>
<span id="cb51-387"><a href="#cb51-387" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb51-388"><a href="#cb51-388" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> ga_counties) <span class="sc">+</span></span>
<span id="cb51-389"><a href="#cb51-389" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>()</span>
<span id="cb51-390"><a href="#cb51-390" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-391"><a href="#cb51-391" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-392"><a href="#cb51-392" aria-hidden="true" tabindex="-1"></a>Technically we can just draw the county boundaries instead of layer the state boundary + the counties, since the borders of the counties make up the border of the state. But there's an advantage to including both: we can use different aesthetics on each, like adding a thicker border on the state:</span>
<span id="cb51-393"><a href="#cb51-393" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-394"><a href="#cb51-394" aria-hidden="true" tabindex="-1"></a><span class="in">```{r ga-counties-in-state}</span></span>
<span id="cb51-395"><a href="#cb51-395" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb51-396"><a href="#cb51-396" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> only_georgia_high, <span class="at">color =</span> <span class="st">"#EC8E55"</span>, <span class="at">linewidth =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb51-397"><a href="#cb51-397" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> ga_counties, <span class="at">fill =</span> <span class="st">"#A5D46A"</span>, <span class="at">color =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb51-398"><a href="#cb51-398" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>()</span>
<span id="cb51-399"><a href="#cb51-399" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-400"><a href="#cb51-400" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-401"><a href="#cb51-401" aria-hidden="true" tabindex="-1"></a>It's also useful if we want to only show some counties, like metropolitan Atlanta:</span>
<span id="cb51-402"><a href="#cb51-402" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-403"><a href="#cb51-403" aria-hidden="true" tabindex="-1"></a><span class="in">```{r atl-counties-in-state}</span></span>
<span id="cb51-404"><a href="#cb51-404" aria-hidden="true" tabindex="-1"></a>atl_counties <span class="ot">&lt;-</span> ga_counties <span class="sc">|&gt;</span> </span>
<span id="cb51-405"><a href="#cb51-405" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(NAME <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Cherokee"</span>, <span class="st">"Clayton"</span>, <span class="st">"Cobb"</span>, <span class="st">"DeKalb"</span>, <span class="st">"Douglas"</span>,</span>
<span id="cb51-406"><a href="#cb51-406" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"Fayette"</span>, <span class="st">"Fulton"</span>, <span class="st">"Gwinnett"</span>, <span class="st">"Henry"</span>, <span class="st">"Rockdale"</span>))</span>
<span id="cb51-407"><a href="#cb51-407" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb51-408"><a href="#cb51-408" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> only_georgia_high, <span class="at">fill =</span> <span class="st">"#EC8E55"</span>) <span class="sc">+</span></span>
<span id="cb51-409"><a href="#cb51-409" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> atl_counties, <span class="at">fill =</span> <span class="st">"#A5D46A"</span>, <span class="at">color =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb51-410"><a href="#cb51-410" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>()</span>
<span id="cb51-411"><a href="#cb51-411" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-412"><a href="#cb51-412" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-413"><a href="#cb51-413" aria-hidden="true" tabindex="-1"></a><span class="fu">## Plotting multiple shapefile layers when some are bigger than the parent shape</span></span>
<span id="cb51-414"><a href="#cb51-414" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-415"><a href="#cb51-415" aria-hidden="true" tabindex="-1"></a>So far we've been able to filter out states and counties that we don't want to plot using <span class="in">`filter()`</span>, which works because the shapefiles have geometry data for each state or county. But what if you're plotting stuff that doesn't follow state or county boundaries, like freeways, roads, rivers, or lakes? </span>
<span id="cb51-416"><a href="#cb51-416" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-417"><a href="#cb51-417" aria-hidden="true" tabindex="-1"></a>At the beginning we loaded a shapefile for all large and small rivers in the US. Look at the first few rows of <span class="in">`rivers_na`</span>:</span>
<span id="cb51-418"><a href="#cb51-418" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-419"><a href="#cb51-419" aria-hidden="true" tabindex="-1"></a><span class="in">```{r head-river-small}</span></span>
<span id="cb51-420"><a href="#cb51-420" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(rivers_na)</span>
<span id="cb51-421"><a href="#cb51-421" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-422"><a href="#cb51-422" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-423"><a href="#cb51-423" aria-hidden="true" tabindex="-1"></a>The first row is the whole Colorado river, which flows through seven states. We can't just use <span class="in">`filter()`</span> to only select some parts of it based on states.</span>
<span id="cb51-424"><a href="#cb51-424" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-425"><a href="#cb51-425" aria-hidden="true" tabindex="-1"></a>Here's what happens if we combine our Georgia map with rivers and lakes:</span>
<span id="cb51-426"><a href="#cb51-426" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-427"><a href="#cb51-427" aria-hidden="true" tabindex="-1"></a><span class="in">```{r ga-rivers-bad}</span></span>
<span id="cb51-428"><a href="#cb51-428" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb51-429"><a href="#cb51-429" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> only_georgia, <span class="at">fill =</span> <span class="st">"#EC8E55"</span>) <span class="sc">+</span></span>
<span id="cb51-430"><a href="#cb51-430" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> rivers_na) <span class="sc">+</span></span>
<span id="cb51-431"><a href="#cb51-431" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>()</span>
<span id="cb51-432"><a href="#cb51-432" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-433"><a href="#cb51-433" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-434"><a href="#cb51-434" aria-hidden="true" tabindex="-1"></a>It plots Georgia, and it's filled with orange, but it also plots every single river in North America. Oops.</span>
<span id="cb51-435"><a href="#cb51-435" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-436"><a href="#cb51-436" aria-hidden="true" tabindex="-1"></a>We need to do a little GIS work to basically use <span class="in">`only_georgia`</span> as a cookie cutter and keep only the rivers that are contained in the <span class="in">`only_georgia`</span> boundaries. Fortunately, there's a function in the {sf} package that does this: <span class="in">`st_intersection()`</span>. Feed it two shapefile datasets and it will select the parts of the second that fall within the boundaries of the first:</span>
<span id="cb51-437"><a href="#cb51-437" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-438"><a href="#cb51-438" aria-hidden="true" tabindex="-1"></a><span class="in">```{r ga-cut-rivers-nope, error=TRUE}</span></span>
<span id="cb51-439"><a href="#cb51-439" aria-hidden="true" tabindex="-1"></a>ga_rivers_na <span class="ot">&lt;-</span> <span class="fu">st_intersection</span>(only_georgia, rivers_na)</span>
<span id="cb51-440"><a href="#cb51-440" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-441"><a href="#cb51-441" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-442"><a href="#cb51-442" aria-hidden="true" tabindex="-1"></a>Oh no! An error! It's complaining that the reference systems used in these two datasets don't match. We can check the CRS with <span class="in">`st_crs()`</span>:</span>
<span id="cb51-443"><a href="#cb51-443" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-444"><a href="#cb51-444" aria-hidden="true" tabindex="-1"></a><span class="in">```{r check-crs}</span></span>
<span id="cb51-445"><a href="#cb51-445" aria-hidden="true" tabindex="-1"></a><span class="fu">st_crs</span>(only_georgia)</span>
<span id="cb51-446"><a href="#cb51-446" aria-hidden="true" tabindex="-1"></a><span class="fu">st_crs</span>(rivers_na)</span>
<span id="cb51-447"><a href="#cb51-447" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-448"><a href="#cb51-448" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-449"><a href="#cb51-449" aria-hidden="true" tabindex="-1"></a>The Georgia map uses EPSG:4269 (<span class="co">[</span><span class="ot">or NAD83</span><span class="co">](https://epsg.io/4269)</span>), while the rivers map uses EPSG:4326 (or <span class="co">[</span><span class="ot">the GPS system of latitude and longitude</span><span class="co">](https://epsg.io/4326)</span>). We need to convert one of them to make them match. It doesn't matter which one.</span>
<span id="cb51-450"><a href="#cb51-450" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-451"><a href="#cb51-451" aria-hidden="true" tabindex="-1"></a><span class="in">```{r ga-cut-rivers-yep}</span></span>
<span id="cb51-452"><a href="#cb51-452" aria-hidden="true" tabindex="-1"></a>only_georgia_4326 <span class="ot">&lt;-</span> only_georgia <span class="sc">|&gt;</span> </span>
<span id="cb51-453"><a href="#cb51-453" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="at">crs =</span> <span class="fu">st_crs</span>(<span class="st">"EPSG:4326"</span>))</span>
<span id="cb51-454"><a href="#cb51-454" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-455"><a href="#cb51-455" aria-hidden="true" tabindex="-1"></a>ga_rivers_na <span class="ot">&lt;-</span> <span class="fu">st_intersection</span>(only_georgia_4326, rivers_na)</span>
<span id="cb51-456"><a href="#cb51-456" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-457"><a href="#cb51-457" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-458"><a href="#cb51-458" aria-hidden="true" tabindex="-1"></a>You'll get an ominous warning, but you should be okay—it's just because flattening globes into flat planes is hard, and the cutting <span class="co">[</span><span class="ot">might not be 100% accurate</span><span class="co">](https://github.com/r-spatial/sf/issues/493)</span>, but it'll be close enough for our mapping purposes.</span>
<span id="cb51-459"><a href="#cb51-459" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-460"><a href="#cb51-460" aria-hidden="true" tabindex="-1"></a>Now we can plot our state shape and the truncated rivers:</span>
<span id="cb51-461"><a href="#cb51-461" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-462"><a href="#cb51-462" aria-hidden="true" tabindex="-1"></a><span class="in">```{r ga-rivers-good}</span></span>
<span id="cb51-463"><a href="#cb51-463" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb51-464"><a href="#cb51-464" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> only_georgia, <span class="at">fill =</span> <span class="st">"#EC8E55"</span>) <span class="sc">+</span></span>
<span id="cb51-465"><a href="#cb51-465" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> ga_rivers_na) <span class="sc">+</span></span>
<span id="cb51-466"><a href="#cb51-466" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>()</span>
<span id="cb51-467"><a href="#cb51-467" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-468"><a href="#cb51-468" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-469"><a href="#cb51-469" aria-hidden="true" tabindex="-1"></a>Hey! It worked! Let's put all the rivers and lakes on at once and make it a little more artsy. We'll use the high resolution Georgia map too, which conveniently already matches the CRS of the rivers and lakes:</span>
<span id="cb51-470"><a href="#cb51-470" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-471"><a href="#cb51-471" aria-hidden="true" tabindex="-1"></a><span class="in">```{r ga-all-water, warning=FALSE, message=FALSE, fig.width=10, fig.height=6}</span></span>
<span id="cb51-472"><a href="#cb51-472" aria-hidden="true" tabindex="-1"></a>ga_rivers_na <span class="ot">&lt;-</span> <span class="fu">st_intersection</span>(only_georgia_high, rivers_na)</span>
<span id="cb51-473"><a href="#cb51-473" aria-hidden="true" tabindex="-1"></a>ga_rivers_global <span class="ot">&lt;-</span> <span class="fu">st_intersection</span>(only_georgia_high, rivers_global)</span>
<span id="cb51-474"><a href="#cb51-474" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-475"><a href="#cb51-475" aria-hidden="true" tabindex="-1"></a><span class="co"># sf v1.0 changed how it handles shapefiles with spherical elements, which</span></span>
<span id="cb51-476"><a href="#cb51-476" aria-hidden="true" tabindex="-1"></a><span class="co"># apparently the lakes data uses. Currently when using st_intersection() and</span></span>
<span id="cb51-477"><a href="#cb51-477" aria-hidden="true" tabindex="-1"></a><span class="co"># other GIS-related functions, it breaks. This can be fixed by feeding the lakes</span></span>
<span id="cb51-478"><a href="#cb51-478" aria-hidden="true" tabindex="-1"></a><span class="co"># data to st_make_valid(), which does something fancy behind the scenes to make</span></span>
<span id="cb51-479"><a href="#cb51-479" aria-hidden="true" tabindex="-1"></a><span class="co"># it work. See this: https://github.com/r-spatial/sf/issues/1649#issuecomment-853279986</span></span>
<span id="cb51-480"><a href="#cb51-480" aria-hidden="true" tabindex="-1"></a>ga_lakes <span class="ot">&lt;-</span> <span class="fu">st_intersection</span>(only_georgia_high, <span class="fu">st_make_valid</span>(lakes))</span>
<span id="cb51-481"><a href="#cb51-481" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-482"><a href="#cb51-482" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb51-483"><a href="#cb51-483" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> only_georgia_high, </span>
<span id="cb51-484"><a href="#cb51-484" aria-hidden="true" tabindex="-1"></a>          <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">linewidth =</span> <span class="fl">0.1</span>, <span class="at">fill =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb51-485"><a href="#cb51-485" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> ga_rivers_global, <span class="at">linewidth =</span> <span class="fl">0.3</span>, <span class="at">color =</span> <span class="st">"grey80"</span>) <span class="sc">+</span></span>
<span id="cb51-486"><a href="#cb51-486" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> ga_rivers_na, <span class="at">linewidth =</span> <span class="fl">0.15</span>, <span class="at">color =</span> <span class="st">"grey80"</span>) <span class="sc">+</span></span>
<span id="cb51-487"><a href="#cb51-487" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> ga_lakes, <span class="at">linewidth =</span> <span class="fl">0.3</span>, <span class="at">fill =</span> <span class="st">"grey80"</span>, <span class="at">color =</span> <span class="cn">NA</span>) <span class="sc">+</span></span>
<span id="cb51-488"><a href="#cb51-488" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf</span>(<span class="at">crs =</span> <span class="fu">st_crs</span>(<span class="st">"EPSG:4326"</span>)) <span class="sc">+</span>  <span class="co"># NAD83</span></span>
<span id="cb51-489"><a href="#cb51-489" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>()</span>
<span id="cb51-490"><a href="#cb51-490" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-491"><a href="#cb51-491" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-492"><a href="#cb51-492" aria-hidden="true" tabindex="-1"></a>Heck yeah. That's a great map. This is basically what <span class="co">[</span><span class="ot">Kieran Healy did here</span><span class="co">](https://kieranhealy.org/prints/rivers/)</span>, but he used <span class="co">[</span><span class="ot">even more detailed shapefiles from the US Geological Survey</span><span class="co">](https://www.usgs.gov/core-science-systems/ngp/national-hydrography)</span>.</span>
<span id="cb51-493"><a href="#cb51-493" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-494"><a href="#cb51-494" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-495"><a href="#cb51-495" aria-hidden="true" tabindex="-1"></a><span class="fu">## Plotting schools in Georgia</span></span>
<span id="cb51-496"><a href="#cb51-496" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-497"><a href="#cb51-497" aria-hidden="true" tabindex="-1"></a>Shapefiles are not limited to just lines and areas—they can also contain points. I made a free account at the Georgia GIS Clearinghouse, searched for "schools" and found a shapefile of all the K–12 schools in 2009. <span class="co">[</span><span class="ot">This is the direct link to the page</span><span class="co">](https://data.georgiaspatial.org/index.asp?body=preview&amp;dataId=41516)</span>, but it only works if you're logged in to their system. <span class="co">[</span><span class="ot">This is the official metadata for the shapefile</span><span class="co">](https://data.georgiaspatial.org/data/statewide/other/schools_2009.html)</span>, which you can see if you're not logged in, but you can't download anything. It's a dumb system and other states are a lot better at offering their GIS data (like, <span class="co">[</span><span class="ot">here's a shapefile of all of Utah's schools and libraries</span><span class="co">](https://gis.utah.gov/data/society/schools-libraries/)</span> as of 2017, publicly accessible without an account).</span>
<span id="cb51-498"><a href="#cb51-498" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-499"><a href="#cb51-499" aria-hidden="true" tabindex="-1"></a>We loaded the shapefile up at the top, but now let's look at it:</span>
<span id="cb51-500"><a href="#cb51-500" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-503"><a href="#cb51-503" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb51-504"><a href="#cb51-504" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(ga_schools)</span>
<span id="cb51-505"><a href="#cb51-505" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-506"><a href="#cb51-506" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-507"><a href="#cb51-507" aria-hidden="true" tabindex="-1"></a>We have a bunch of columns like <span class="in">`GRADES`</span> that has a list of what grades are included in the school, and <span class="in">`TOTAL`</span>, which I'm guessing is the number of students. Let's map it!</span>
<span id="cb51-508"><a href="#cb51-508" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-509"><a href="#cb51-509" aria-hidden="true" tabindex="-1"></a>If we add a <span class="in">`geom_sf()`</span> layer just for <span class="in">`ga_schools`</span>, it'll plot a bunch of points:</span>
<span id="cb51-510"><a href="#cb51-510" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-511"><a href="#cb51-511" aria-hidden="true" tabindex="-1"></a><span class="in">```{r plot-ga-schools-initial}</span></span>
<span id="cb51-512"><a href="#cb51-512" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb51-513"><a href="#cb51-513" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> ga_schools)</span>
<span id="cb51-514"><a href="#cb51-514" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-515"><a href="#cb51-515" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-516"><a href="#cb51-516" aria-hidden="true" tabindex="-1"></a>One of these rows is wildly miscoded and ended up Indonesia! If you sort by the <span class="in">`geometry`</span> column in RStudio, you'll see that it's most likely Allatoona High School in Cobb County (id = 22097). The coordinates are different from all the others, and it has no congressional district information. Let's remove it.</span>
<span id="cb51-517"><a href="#cb51-517" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-518"><a href="#cb51-518" aria-hidden="true" tabindex="-1"></a><span class="in">```{r plot-ga-schools-fixed}</span></span>
<span id="cb51-519"><a href="#cb51-519" aria-hidden="true" tabindex="-1"></a>ga_schools_fixed <span class="ot">&lt;-</span> ga_schools <span class="sc">|&gt;</span> </span>
<span id="cb51-520"><a href="#cb51-520" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(ID <span class="sc">!=</span> <span class="dv">22097</span>)</span>
<span id="cb51-521"><a href="#cb51-521" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-522"><a href="#cb51-522" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb51-523"><a href="#cb51-523" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> ga_schools_fixed)</span>
<span id="cb51-524"><a href="#cb51-524" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-525"><a href="#cb51-525" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-526"><a href="#cb51-526" aria-hidden="true" tabindex="-1"></a>That's better. However, all we're plotting now are the points—we've lost the state and/or county boundaries. Let's include those:</span>
<span id="cb51-527"><a href="#cb51-527" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-528"><a href="#cb51-528" aria-hidden="true" tabindex="-1"></a><span class="in">```{r plot-ga-schools-borders}</span></span>
<span id="cb51-529"><a href="#cb51-529" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb51-530"><a href="#cb51-530" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> only_georgia_high) <span class="sc">+</span></span>
<span id="cb51-531"><a href="#cb51-531" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> ga_schools_fixed) <span class="sc">+</span></span>
<span id="cb51-532"><a href="#cb51-532" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>()</span>
<span id="cb51-533"><a href="#cb51-533" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-534"><a href="#cb51-534" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-535"><a href="#cb51-535" aria-hidden="true" tabindex="-1"></a>We're getting closer. We have some issues with overplotting, so let's shrink the points down and make them a little transparent:</span>
<span id="cb51-536"><a href="#cb51-536" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-537"><a href="#cb51-537" aria-hidden="true" tabindex="-1"></a><span class="in">```{r plot-ga-schools-shrunk}</span></span>
<span id="cb51-538"><a href="#cb51-538" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb51-539"><a href="#cb51-539" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> only_georgia_high) <span class="sc">+</span></span>
<span id="cb51-540"><a href="#cb51-540" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> ga_schools_fixed, <span class="at">size =</span> <span class="fl">0.5</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb51-541"><a href="#cb51-541" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>()</span>
<span id="cb51-542"><a href="#cb51-542" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-543"><a href="#cb51-543" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-544"><a href="#cb51-544" aria-hidden="true" tabindex="-1"></a>Neat. One last thing we can do is map the <span class="in">`TOTAL`</span> column to the color aesthetic and color the points by how many students attend each school:</span>
<span id="cb51-545"><a href="#cb51-545" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-546"><a href="#cb51-546" aria-hidden="true" tabindex="-1"></a><span class="in">```{r plot-ga-schools-color}</span></span>
<span id="cb51-547"><a href="#cb51-547" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb51-548"><a href="#cb51-548" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> only_georgia_high) <span class="sc">+</span></span>
<span id="cb51-549"><a href="#cb51-549" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> ga_schools_fixed, <span class="fu">aes</span>(<span class="at">color =</span> TOTAL), <span class="at">size =</span> <span class="fl">0.75</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb51-550"><a href="#cb51-550" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_viridis_c</span>() <span class="sc">+</span></span>
<span id="cb51-551"><a href="#cb51-551" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>()</span>
<span id="cb51-552"><a href="#cb51-552" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-553"><a href="#cb51-553" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-554"><a href="#cb51-554" aria-hidden="true" tabindex="-1"></a>Most schools appear to be under 1,000 students, except for a cluster in Gwinnett County north of Atlanta. Its high schools have nearly 4,000 students each!</span>
<span id="cb51-555"><a href="#cb51-555" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-556"><a href="#cb51-556" aria-hidden="true" tabindex="-1"></a><span class="in">```{r show-biggest-schools}</span></span>
<span id="cb51-557"><a href="#cb51-557" aria-hidden="true" tabindex="-1"></a>ga_schools_fixed <span class="sc">|&gt;</span> </span>
<span id="cb51-558"><a href="#cb51-558" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(COUNTY, SCHOOLNAME, TOTAL) <span class="sc">|&gt;</span> </span>
<span id="cb51-559"><a href="#cb51-559" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(TOTAL)) <span class="sc">|&gt;</span> </span>
<span id="cb51-560"><a href="#cb51-560" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>()</span>
<span id="cb51-561"><a href="#cb51-561" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-562"><a href="#cb51-562" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-563"><a href="#cb51-563" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-564"><a href="#cb51-564" aria-hidden="true" tabindex="-1"></a><span class="fu">## Making your own geocoded data</span></span>
<span id="cb51-565"><a href="#cb51-565" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-566"><a href="#cb51-566" aria-hidden="true" tabindex="-1"></a>So, plotting shapefiles with <span class="in">`geom_sf()`</span> is magical because {sf} deals with all of the projection issues for us automatically and it figures out how to plot all the latitude and longitude data for us automatically. But lots of data *doesn't* some as shapefiles. The <span class="co">[</span><span class="ot">rats data from mini project 1</span><span class="co">](/assignment/01-mini-project.qmd)</span>, for instance, has two columns indicating the latitude and longitude of each rat sighting, but those are stored as just numbers. If we try to use <span class="in">`geom_sf()`</span> with the rat data, it won't work. We need that magical <span class="in">`geometry`</span> column.</span>
<span id="cb51-567"><a href="#cb51-567" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-568"><a href="#cb51-568" aria-hidden="true" tabindex="-1"></a>Fortunately, if we have latitude and longitude information, we can make our own <span class="in">`geometry`</span> column. </span>
<span id="cb51-569"><a href="#cb51-569" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-570"><a href="#cb51-570" aria-hidden="true" tabindex="-1"></a>Let's say we want to mark some cities on our map of Georgia. We can make a mini dataset using <span class="in">`tribble()`</span>. I found these points from Google Maps: right click anywhere in Google Maps, select "What's here?", and you'll see the exact coordinates for that spot.</span>
<span id="cb51-571"><a href="#cb51-571" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-572"><a href="#cb51-572" aria-hidden="true" tabindex="-1"></a><span class="in">```{r mini-cities}</span></span>
<span id="cb51-573"><a href="#cb51-573" aria-hidden="true" tabindex="-1"></a>ga_cities <span class="ot">&lt;-</span> <span class="fu">tribble</span>(</span>
<span id="cb51-574"><a href="#cb51-574" aria-hidden="true" tabindex="-1"></a>  <span class="sc">~</span>city, <span class="sc">~</span>lat, <span class="sc">~</span>long,</span>
<span id="cb51-575"><a href="#cb51-575" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Atlanta"</span>, <span class="fl">33.748955</span>, <span class="sc">-</span><span class="fl">84.388099</span>,</span>
<span id="cb51-576"><a href="#cb51-576" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Athens"</span>, <span class="fl">33.950794</span>, <span class="sc">-</span><span class="fl">83.358884</span>,</span>
<span id="cb51-577"><a href="#cb51-577" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Savannah"</span>, <span class="fl">32.113192</span>, <span class="sc">-</span><span class="fl">81.089350</span></span>
<span id="cb51-578"><a href="#cb51-578" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb51-579"><a href="#cb51-579" aria-hidden="true" tabindex="-1"></a>ga_cities</span>
<span id="cb51-580"><a href="#cb51-580" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-581"><a href="#cb51-581" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-582"><a href="#cb51-582" aria-hidden="true" tabindex="-1"></a>This is just a normal dataset, and the <span class="in">`lat`</span> and <span class="in">`long`</span> columns are just numbers. R doesn't know that those are actually geographic coordinates. This is similar to the rats data, or any other data that has columns for latitude and longitude.</span>
<span id="cb51-583"><a href="#cb51-583" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-584"><a href="#cb51-584" aria-hidden="true" tabindex="-1"></a>We can convert those two columns to the magic <span class="in">`geometry`</span> column with the <span class="in">`st_as_sf()`</span> function. We have to define two things in the function: which coordinates are the longitude and latitude, and what CRS the coordinates are using. Google Maps uses <span class="co">[</span><span class="ot">EPSG:4326, or the GPS system</span><span class="co">](http://epsg.io/4326)</span>, so we specify that:</span>
<span id="cb51-585"><a href="#cb51-585" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-586"><a href="#cb51-586" aria-hidden="true" tabindex="-1"></a><span class="in">```{r mini-cities-convert}</span></span>
<span id="cb51-587"><a href="#cb51-587" aria-hidden="true" tabindex="-1"></a>ga_cities_geometry <span class="ot">&lt;-</span> ga_cities <span class="sc">|&gt;</span> </span>
<span id="cb51-588"><a href="#cb51-588" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_as_sf</span>(<span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"long"</span>, <span class="st">"lat"</span>), <span class="at">crs =</span> <span class="fu">st_crs</span>(<span class="st">"EPSG:4326"</span>))</span>
<span id="cb51-589"><a href="#cb51-589" aria-hidden="true" tabindex="-1"></a>ga_cities_geometry</span>
<span id="cb51-590"><a href="#cb51-590" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-591"><a href="#cb51-591" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-592"><a href="#cb51-592" aria-hidden="true" tabindex="-1"></a>The longitude and latitude columns are gone now, and we have a single magical <span class="in">`geometry`</span> column. That means we can plot it with <span class="in">`geom_sf()`</span>:</span>
<span id="cb51-593"><a href="#cb51-593" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-594"><a href="#cb51-594" aria-hidden="true" tabindex="-1"></a><span class="in">```{r ga-with-cities}</span></span>
<span id="cb51-595"><a href="#cb51-595" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb51-596"><a href="#cb51-596" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> only_georgia_high, <span class="at">fill =</span> <span class="st">"#EC8E55"</span>) <span class="sc">+</span></span>
<span id="cb51-597"><a href="#cb51-597" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> ga_cities_geometry, <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb51-598"><a href="#cb51-598" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>()</span>
<span id="cb51-599"><a href="#cb51-599" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-600"><a href="#cb51-600" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-601"><a href="#cb51-601" aria-hidden="true" tabindex="-1"></a>We can use <span class="in">`geom_sf_label()`</span> (or <span class="in">`geom_sf_text()`</span>) to add labels in the correct locations too. It will give you a warning, but you can ignore it—again, it's complaining that the positioning might not be 100% accurate because of issues related to taking a globe and flattening it. It's fine.</span>
<span id="cb51-602"><a href="#cb51-602" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-603"><a href="#cb51-603" aria-hidden="true" tabindex="-1"></a><span class="in">```{r ga-with-cities-text, warning=FALSE, fig.width=10, fig.height=6}</span></span>
<span id="cb51-604"><a href="#cb51-604" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb51-605"><a href="#cb51-605" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> only_georgia_high, <span class="at">fill =</span> <span class="st">"#EC8E55"</span>) <span class="sc">+</span></span>
<span id="cb51-606"><a href="#cb51-606" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> ga_cities_geometry, <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb51-607"><a href="#cb51-607" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf_label</span>(<span class="at">data =</span> ga_cities_geometry, <span class="fu">aes</span>(<span class="at">label =</span> city),</span>
<span id="cb51-608"><a href="#cb51-608" aria-hidden="true" tabindex="-1"></a>                <span class="at">nudge_y =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb51-609"><a href="#cb51-609" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>()</span>
<span id="cb51-610"><a href="#cb51-610" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-611"><a href="#cb51-611" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-612"><a href="#cb51-612" aria-hidden="true" tabindex="-1"></a><span class="fu">## Automatic geocoding by address</span></span>
<span id="cb51-613"><a href="#cb51-613" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-614"><a href="#cb51-614" aria-hidden="true" tabindex="-1"></a>Using <span class="in">`st_as_sf()`</span> is neat when you have latitude and longitude data already, but what if you have a list of addresses or cities instead, with no fancy geographic information? It's easy enough to right click on Google Maps, but you don't really want to do that hundreds of times for large-scale data.</span>
<span id="cb51-615"><a href="#cb51-615" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-616"><a href="#cb51-616" aria-hidden="true" tabindex="-1"></a>Fortunately there are a bunch of different online geocoding services that return GIS data for addresses and locations that you feed them, like magic. </span>
<span id="cb51-617"><a href="#cb51-617" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-618"><a href="#cb51-618" aria-hidden="true" tabindex="-1"></a>The easiest way to use any of these services is to use the <span class="co">[</span><span class="ot">{tidygeocoder}</span><span class="co">](https://jessecambon.github.io/tidygeocoder/)</span> package, which connects with all these different free and paid services (run <span class="in">`?geo`</span> in R for complete details):</span>
<span id="cb51-619"><a href="#cb51-619" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-620"><a href="#cb51-620" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`"osm"`</span>: OpenStreetMap through <span class="co">[</span><span class="ot">Nominatim</span><span class="co">](https://nominatim.org/)</span>. **FREE**.</span>
<span id="cb51-621"><a href="#cb51-621" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`"census"`</span>: <span class="co">[</span><span class="ot">US Census</span><span class="co">](https://geocoding.geo.census.gov/)</span>. Geographic coverage is limited to the United States. **FREE**.</span>
<span id="cb51-622"><a href="#cb51-622" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`"arcgis"`</span>: <span class="co">[</span><span class="ot">ArcGIS</span><span class="co">](https://developers.arcgis.com/rest/geocode/api-reference/overview-world-geocoding-service.htm)</span>. **FREE** and paid.</span>
<span id="cb51-623"><a href="#cb51-623" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`"geocodio"`</span>: <span class="co">[</span><span class="ot">Geocodio</span><span class="co">](https://www.geocod.io/)</span>. Geographic coverage is limited to the United States and Canada. An API key must be stored in <span class="in">`"GEOCODIO_API_KEY"`</span>.</span>
<span id="cb51-624"><a href="#cb51-624" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`"iq"`</span>: <span class="co">[</span><span class="ot">Location IQ</span><span class="co">](https://locationiq.com/)</span>. An API key must be stored in <span class="in">`"LOCATIONIQ_API_KEY"`</span>.</span>
<span id="cb51-625"><a href="#cb51-625" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`"google"`</span>: <span class="co">[</span><span class="ot">Google</span><span class="co">](https://developers.google.com/maps/documentation/geocoding/overview)</span>. An API key must be stored in <span class="in">`"GOOGLEGEOCODE_API_KEY"`</span>.</span>
<span id="cb51-626"><a href="#cb51-626" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`"opencage"`</span>: <span class="co">[</span><span class="ot">OpenCage</span><span class="co">](https://opencagedata.com/)</span>. An API key must be stored in <span class="in">`"OPENCAGE_KEY"`</span>.</span>
<span id="cb51-627"><a href="#cb51-627" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`"mapbox"`</span>: <span class="co">[</span><span class="ot">Mapbox</span><span class="co">](https://docs.mapbox.com/api/search/)</span>. An API key must be stored in <span class="in">`"MAPBOX_API_KEY"`</span>.</span>
<span id="cb51-628"><a href="#cb51-628" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`"here"`</span>: <span class="co">[</span><span class="ot">HERE</span><span class="co">](https://developer.here.com/products/geocoding-and-search)</span>. An API key must be stored in <span class="in">`"HERE_API_KEY"`</span>.</span>
<span id="cb51-629"><a href="#cb51-629" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`"tomtom"`</span>: <span class="co">[</span><span class="ot">TomTom</span><span class="co">](https://developer.tomtom.com/search-api/search-api-documentation/geocoding)</span>. An API key must be stored in <span class="in">`"TOMTOM_API_KEY"`</span>.</span>
<span id="cb51-630"><a href="#cb51-630" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`"mapquest"`</span>: <span class="co">[</span><span class="ot">MapQuest</span><span class="co">](https://developer.mapquest.com/documentation/geocoding-api/)</span>. An API key must be stored in <span class="in">`"MAPQUEST_API_KEY"`</span>.</span>
<span id="cb51-631"><a href="#cb51-631" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`"bing"`</span>: <span class="co">[</span><span class="ot">Bing</span><span class="co">](https://docs.microsoft.com/en-us/bingmaps/rest-services/locations/)</span>. An API key must be stored in <span class="in">`"BINGMAPS_API_KEY"`</span>.</span>
<span id="cb51-632"><a href="#cb51-632" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-633"><a href="#cb51-633" aria-hidden="true" tabindex="-1"></a>Not all services work equally well, and the free ones have rate limits (like, don't try to geocode a million rows of data with the US Census), so you'll have to play around with different services. You can also provide a list of services and {tidygeocoder} will cascade through them—if it can't geocode an address with OpenStreetMap, it can move on to the Census, then ArcGIS, and so on. You need to set the <span class="in">`cascade_order`</span> argument in <span class="in">`geocode()`</span> for this to work.</span>
<span id="cb51-634"><a href="#cb51-634" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-635"><a href="#cb51-635" aria-hidden="true" tabindex="-1"></a>Let's make a little dataset with some addresses to geocode: </span>
<span id="cb51-636"><a href="#cb51-636" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-637"><a href="#cb51-637" aria-hidden="true" tabindex="-1"></a><span class="in">```{r build-some-addresses}</span></span>
<span id="cb51-638"><a href="#cb51-638" aria-hidden="true" tabindex="-1"></a>some_addresses <span class="ot">&lt;-</span> <span class="fu">tribble</span>(</span>
<span id="cb51-639"><a href="#cb51-639" aria-hidden="true" tabindex="-1"></a>  <span class="sc">~</span>name,             <span class="sc">~</span>address,</span>
<span id="cb51-640"><a href="#cb51-640" aria-hidden="true" tabindex="-1"></a>  <span class="st">"The White House"</span>, <span class="st">"1600 Pennsylvania Ave NW, Washington, DC"</span>,</span>
<span id="cb51-641"><a href="#cb51-641" aria-hidden="true" tabindex="-1"></a>  <span class="st">"The Andrew Young School of Policy Studies"</span>, <span class="st">"55 Park Place SE, Atlanta, GA 30303"</span></span>
<span id="cb51-642"><a href="#cb51-642" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb51-643"><a href="#cb51-643" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-644"><a href="#cb51-644" aria-hidden="true" tabindex="-1"></a>some_addresses</span>
<span id="cb51-645"><a href="#cb51-645" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-646"><a href="#cb51-646" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-647"><a href="#cb51-647" aria-hidden="true" tabindex="-1"></a>To geocode these addresses, we can feed this data into <span class="in">`geocode()`</span> and tell it to use the <span class="in">`address`</span> column. We'll use the Census geocoding system for fun (surely they know where the White House is):</span>
<span id="cb51-648"><a href="#cb51-648" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-649"><a href="#cb51-649" aria-hidden="true" tabindex="-1"></a><span class="in">```{r geocode-fake, eval=FALSE}</span></span>
<span id="cb51-650"><a href="#cb51-650" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidygeocoder)</span>
<span id="cb51-651"><a href="#cb51-651" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-652"><a href="#cb51-652" aria-hidden="true" tabindex="-1"></a>geocoded_addresses <span class="ot">&lt;-</span> some_addresses <span class="sc">|&gt;</span> </span>
<span id="cb51-653"><a href="#cb51-653" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geocode</span>(address, <span class="at">method =</span> <span class="st">"census"</span>)</span>
<span id="cb51-654"><a href="#cb51-654" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-655"><a href="#cb51-655" aria-hidden="true" tabindex="-1"></a>geocoded_addresses</span>
<span id="cb51-656"><a href="#cb51-656" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-657"><a href="#cb51-657" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-658"><a href="#cb51-658" aria-hidden="true" tabindex="-1"></a><span class="in">```{r show-geocode, echo=FALSE}</span></span>
<span id="cb51-659"><a href="#cb51-659" aria-hidden="true" tabindex="-1"></a>geocoded_addresses <span class="sc">|&gt;</span> </span>
<span id="cb51-660"><a href="#cb51-660" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(name, lat, long)</span>
<span id="cb51-661"><a href="#cb51-661" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-662"><a href="#cb51-662" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-663"><a href="#cb51-663" aria-hidden="true" tabindex="-1"></a>It worked!</span>
<span id="cb51-664"><a href="#cb51-664" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-665"><a href="#cb51-665" aria-hidden="true" tabindex="-1"></a>Those are just numbers, though, and not the magical <span class="in">`geometry`</span> column, so we need to use <span class="in">`st_as_sf()`</span> to convert them to actual GIS data.</span>
<span id="cb51-666"><a href="#cb51-666" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-667"><a href="#cb51-667" aria-hidden="true" tabindex="-1"></a><span class="in">```{r st-as-sf-geocoded}</span></span>
<span id="cb51-668"><a href="#cb51-668" aria-hidden="true" tabindex="-1"></a>addresses_geometry <span class="ot">&lt;-</span> geocoded_addresses <span class="sc">|&gt;</span> </span>
<span id="cb51-669"><a href="#cb51-669" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_as_sf</span>(<span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"long"</span>, <span class="st">"lat"</span>), <span class="at">crs =</span> <span class="fu">st_crs</span>(<span class="st">"EPSG:4326"</span>))</span>
<span id="cb51-670"><a href="#cb51-670" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-671"><a href="#cb51-671" aria-hidden="true" tabindex="-1"></a>addresses_geometry <span class="sc">|&gt;</span> <span class="fu">select</span>(<span class="sc">-</span>address)</span>
<span id="cb51-672"><a href="#cb51-672" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-673"><a href="#cb51-673" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-674"><a href="#cb51-674" aria-hidden="true" tabindex="-1"></a>Let's plot these on a US map:</span>
<span id="cb51-675"><a href="#cb51-675" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-676"><a href="#cb51-676" aria-hidden="true" tabindex="-1"></a><span class="in">```{r plot-geocoded-cities}</span></span>
<span id="cb51-677"><a href="#cb51-677" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb51-678"><a href="#cb51-678" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> lower_48, <span class="at">fill =</span> <span class="st">"#192DA1"</span>, <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">linewidth =</span> <span class="fl">0.25</span>) <span class="sc">+</span></span>
<span id="cb51-679"><a href="#cb51-679" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> addresses_geometry, <span class="at">size =</span> <span class="dv">5</span>, <span class="at">color =</span> <span class="st">"#FF851B"</span>) <span class="sc">+</span></span>
<span id="cb51-680"><a href="#cb51-680" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Albers uses meters as its unit of measurement, so we need to nudge these</span></span>
<span id="cb51-681"><a href="#cb51-681" aria-hidden="true" tabindex="-1"></a>  <span class="co"># labels up by a lot. I only settled on 175,000 here after a bunch of trial</span></span>
<span id="cb51-682"><a href="#cb51-682" aria-hidden="true" tabindex="-1"></a>  <span class="co"># and error, adding single zeroes and rerunning the plot until the labels</span></span>
<span id="cb51-683"><a href="#cb51-683" aria-hidden="true" tabindex="-1"></a>  <span class="co"># moved. 175,000 meters = 108.74 miles</span></span>
<span id="cb51-684"><a href="#cb51-684" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf_label</span>(<span class="at">data =</span> addresses_geometry, <span class="fu">aes</span>(<span class="at">label =</span> name),</span>
<span id="cb51-685"><a href="#cb51-685" aria-hidden="true" tabindex="-1"></a>                <span class="at">size =</span> <span class="dv">4</span>, <span class="at">fill =</span> <span class="st">"#FF851B"</span>, <span class="at">nudge_y =</span> <span class="dv">175000</span>) <span class="sc">+</span> </span>
<span id="cb51-686"><a href="#cb51-686" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf</span>(<span class="at">crs =</span> <span class="fu">st_crs</span>(<span class="st">"ESRI:102003"</span>)) <span class="sc">+</span>  <span class="co"># Albers</span></span>
<span id="cb51-687"><a href="#cb51-687" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>()</span>
<span id="cb51-688"><a href="#cb51-688" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-689"><a href="#cb51-689" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-690"><a href="#cb51-690" aria-hidden="true" tabindex="-1"></a><span class="fu">## Plotting other data on maps</span></span>
<span id="cb51-691"><a href="#cb51-691" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-692"><a href="#cb51-692" aria-hidden="true" tabindex="-1"></a>So far we've just plotted whatever data the shapefile creators decided to include and publish in their data. But what if you want to visualize some other variable on a map? We can do this by combining our shapefile data with any other kind of data, as long as the two have a shared column. For instance, we can make a choropleth map of life expectancy with data from the World Bank.</span>
<span id="cb51-693"><a href="#cb51-693" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-694"><a href="#cb51-694" aria-hidden="true" tabindex="-1"></a>First, let's grab some data from the World Bank for just 2015:</span>
<span id="cb51-695"><a href="#cb51-695" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-696"><a href="#cb51-696" aria-hidden="true" tabindex="-1"></a><span class="in">```{r get-wdi, eval=FALSE}</span></span>
<span id="cb51-697"><a href="#cb51-697" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(WDI)  <span class="co"># For getting data from the World Bank</span></span>
<span id="cb51-698"><a href="#cb51-698" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-699"><a href="#cb51-699" aria-hidden="true" tabindex="-1"></a>indicators <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="at">life_expectancy =</span> <span class="st">"SP.DYN.LE00.IN"</span>)  <span class="co"># Life expectancy</span></span>
<span id="cb51-700"><a href="#cb51-700" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-701"><a href="#cb51-701" aria-hidden="true" tabindex="-1"></a>wdi_raw <span class="ot">&lt;-</span> <span class="fu">WDI</span>(<span class="at">country =</span> <span class="st">"all"</span>, indicators, <span class="at">extra =</span> <span class="cn">TRUE</span>, </span>
<span id="cb51-702"><a href="#cb51-702" aria-hidden="true" tabindex="-1"></a>               <span class="at">start =</span> <span class="dv">2015</span>, <span class="at">end =</span> <span class="dv">2015</span>)</span>
<span id="cb51-703"><a href="#cb51-703" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-704"><a href="#cb51-704" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-705"><a href="#cb51-705" aria-hidden="true" tabindex="-1"></a><span class="in">```{r load-wdi, include=FALSE}</span></span>
<span id="cb51-706"><a href="#cb51-706" aria-hidden="true" tabindex="-1"></a>wdi_raw <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(here<span class="sc">::</span><span class="fu">here</span>(wdi_path))</span>
<span id="cb51-707"><a href="#cb51-707" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-708"><a href="#cb51-708" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-709"><a href="#cb51-709" aria-hidden="true" tabindex="-1"></a>Let's see what we got:</span>
<span id="cb51-710"><a href="#cb51-710" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-711"><a href="#cb51-711" aria-hidden="true" tabindex="-1"></a><span class="in">```{r head-wdi-raw}</span></span>
<span id="cb51-712"><a href="#cb51-712" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(wdi_raw)</span>
<span id="cb51-713"><a href="#cb51-713" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-714"><a href="#cb51-714" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-715"><a href="#cb51-715" aria-hidden="true" tabindex="-1"></a>We have a bunch of columns here, but we care about two in particular: life expectancy, and the ISO3 code. This three-letter code is a standard system for identifying countries (<span class="co">[</span><span class="ot">see the full list here</span><span class="co">](https://en.wikipedia.org/wiki/ISO_3166-1_alpha-3)</span>), and that column will let us combine this World Bank data with the global shapefile, which also has a column for the ISO3 code.</span>
<span id="cb51-716"><a href="#cb51-716" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-717"><a href="#cb51-717" aria-hidden="true" tabindex="-1"></a>::: {.callout-note}</span>
<span id="cb51-718"><a href="#cb51-718" aria-hidden="true" tabindex="-1"></a><span class="fu">### World capitals</span></span>
<span id="cb51-719"><a href="#cb51-719" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-720"><a href="#cb51-720" aria-hidden="true" tabindex="-1"></a>We also have columns for the latitude and longitude for each capital, so we could theoretically convert those to a <span class="in">`geometry`</span> column with <span class="in">`st_as_sf()`</span> and plot world capitals, which would be neat, but we won't do that now.</span>
<span id="cb51-721"><a href="#cb51-721" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb51-722"><a href="#cb51-722" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-723"><a href="#cb51-723" aria-hidden="true" tabindex="-1"></a>Let's clean up the WDI data by shrinking it down substantially so we only join the one <span class="in">`life_expectancy`</span> column that we care about:</span>
<span id="cb51-724"><a href="#cb51-724" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-725"><a href="#cb51-725" aria-hidden="true" tabindex="-1"></a><span class="in">```{r clean-wdi}</span></span>
<span id="cb51-726"><a href="#cb51-726" aria-hidden="true" tabindex="-1"></a>wdi_clean_small <span class="ot">&lt;-</span> wdi_raw <span class="sc">|&gt;</span> </span>
<span id="cb51-727"><a href="#cb51-727" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(life_expectancy, iso3c)</span>
<span id="cb51-728"><a href="#cb51-728" aria-hidden="true" tabindex="-1"></a>wdi_clean_small</span>
<span id="cb51-729"><a href="#cb51-729" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-730"><a href="#cb51-730" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-731"><a href="#cb51-731" aria-hidden="true" tabindex="-1"></a>Next we need to merge this tiny dataset into the <span class="in">`world_map_sans_antarctica`</span> shapefile data we were using earlier. To do this we'll use a function named <span class="in">`left_join()`</span>. We feed two data frames into <span class="in">`left_join()`</span>, and R will keep all the rows from the first and include all the columns from both the first and the second wherever the two datasets match with one specific column. That's wordy and weird—<span class="co">[</span><span class="ot">stare at this animation here</span><span class="co">](https://github.com/gadenbuie/tidyexplain#left-join)</span> for a few seconds to see what's really going to happen. We're essentially going to append the World Bank data to the end of the world shapefiles and line up rows that have matching ISO3 codes. The ISO3 column is named <span class="in">`ISO_A3`</span> in the shapefile data, and it's named <span class="in">`iso3c`</span> in the WDI data, so we tell <span class="in">`left_join()`</span> that those are the same column:</span>
<span id="cb51-732"><a href="#cb51-732" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-733"><a href="#cb51-733" aria-hidden="true" tabindex="-1"></a><span class="in">```{r combine-map-wdi}</span></span>
<span id="cb51-734"><a href="#cb51-734" aria-hidden="true" tabindex="-1"></a>world_map_with_life_expectancy <span class="ot">&lt;-</span> world_sans_antarctica <span class="sc">|&gt;</span> </span>
<span id="cb51-735"><a href="#cb51-735" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(wdi_clean_small, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"ISO_A3"</span> <span class="ot">=</span> <span class="st">"iso3c"</span>))</span>
<span id="cb51-736"><a href="#cb51-736" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-737"><a href="#cb51-737" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-738"><a href="#cb51-738" aria-hidden="true" tabindex="-1"></a>If you look at this dataset in RStudio now and look at the last column, you'll see the WDI life expectancy right next to the magic <span class="in">`geometry`</span> column.</span>
<span id="cb51-739"><a href="#cb51-739" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-740"><a href="#cb51-740" aria-hidden="true" tabindex="-1"></a>We technically didn't need to shrink the WDI data down to just two columns—had we left everything else, all the WDI columns would have come over to the <span class="in">`world_sans_antarctica`</span>, including columns for region and income level, etc. But I generally find it easier and cleaner to only merge in the columns I care about instead of making massive datasets with a billion extra columns.</span>
<span id="cb51-741"><a href="#cb51-741" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-742"><a href="#cb51-742" aria-hidden="true" tabindex="-1"></a>Now that we have a column for life expectancy, we can map it to the fill aesthetic and fill each country by 2015 life expectancy:</span>
<span id="cb51-743"><a href="#cb51-743" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-744"><a href="#cb51-744" aria-hidden="true" tabindex="-1"></a><span class="in">```{r world-life-exp-2015, fig.width=10, fig.height=6}</span></span>
<span id="cb51-745"><a href="#cb51-745" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb51-746"><a href="#cb51-746" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> world_map_with_life_expectancy, </span>
<span id="cb51-747"><a href="#cb51-747" aria-hidden="true" tabindex="-1"></a>          <span class="fu">aes</span>(<span class="at">fill =</span> life_expectancy),</span>
<span id="cb51-748"><a href="#cb51-748" aria-hidden="true" tabindex="-1"></a>          <span class="at">linewidth =</span> <span class="fl">0.25</span>) <span class="sc">+</span></span>
<span id="cb51-749"><a href="#cb51-749" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf</span>(<span class="at">crs =</span> <span class="fu">st_crs</span>(<span class="st">"ESRI:54030"</span>)) <span class="sc">+</span>  <span class="co"># Robinson</span></span>
<span id="cb51-750"><a href="#cb51-750" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_c</span>(<span class="at">option =</span> <span class="st">"viridis"</span>) <span class="sc">+</span></span>
<span id="cb51-751"><a href="#cb51-751" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">fill =</span> <span class="st">"Life expectancy"</span>) <span class="sc">+</span></span>
<span id="cb51-752"><a href="#cb51-752" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb51-753"><a href="#cb51-753" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span>
<span id="cb51-754"><a href="#cb51-754" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb51-755"><a href="#cb51-755" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-756"><a href="#cb51-756" aria-hidden="true" tabindex="-1"></a>Voila! Global life expectancy in 2015!</span>
<span id="cb51-757"><a href="#cb51-757" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-758"><a href="#cb51-758" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb51-759"><a href="#cb51-759" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-760"><a href="#cb51-760" aria-hidden="true" tabindex="-1"></a>::: {.callout-tip}</span>
<span id="cb51-761"><a href="#cb51-761" aria-hidden="true" tabindex="-1"></a><span class="fu">### France and Norway</span></span>
<span id="cb51-762"><a href="#cb51-762" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-763"><a href="#cb51-763" aria-hidden="true" tabindex="-1"></a>Sharp-eyed readers will notice that France and Norway are grayed out because they're missing data. That's because the <span class="in">`ISO_A3`</span> code in the Natural Earth data is missing for both France and Norway for whatever reason, so the WDI data didn't merge with those rows. To fix that, we can do some manual recoding before joining in the WDI data.</span>
<span id="cb51-764"><a href="#cb51-764" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb51-765"><a href="#cb51-765" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-766"><a href="#cb51-766" aria-hidden="true" tabindex="-1"></a><span class="in">```{r world-life-exp-2015-fixed, fig.width=10, fig.height=6}</span></span>
<span id="cb51-767"><a href="#cb51-767" aria-hidden="true" tabindex="-1"></a>world_sans_antarctica_fixed <span class="ot">&lt;-</span> world_sans_antarctica <span class="sc">|&gt;</span> </span>
<span id="cb51-768"><a href="#cb51-768" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ISO_A3 =</span> <span class="fu">case_when</span>(</span>
<span id="cb51-769"><a href="#cb51-769" aria-hidden="true" tabindex="-1"></a>    <span class="co"># If the country name is Norway or France, redo the ISO3 code</span></span>
<span id="cb51-770"><a href="#cb51-770" aria-hidden="true" tabindex="-1"></a>    ADMIN <span class="sc">==</span> <span class="st">"Norway"</span> <span class="sc">~</span> <span class="st">"NOR"</span>,</span>
<span id="cb51-771"><a href="#cb51-771" aria-hidden="true" tabindex="-1"></a>    ADMIN <span class="sc">==</span> <span class="st">"France"</span> <span class="sc">~</span> <span class="st">"FRA"</span>,</span>
<span id="cb51-772"><a href="#cb51-772" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Otherwise use the existing ISO3 code</span></span>
<span id="cb51-773"><a href="#cb51-773" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> ISO_A3</span>
<span id="cb51-774"><a href="#cb51-774" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">|&gt;</span> </span>
<span id="cb51-775"><a href="#cb51-775" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(wdi_clean_small, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"ISO_A3"</span> <span class="ot">=</span> <span class="st">"iso3c"</span>))</span>
<span id="cb51-776"><a href="#cb51-776" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-777"><a href="#cb51-777" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb51-778"><a href="#cb51-778" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> world_sans_antarctica_fixed, </span>
<span id="cb51-779"><a href="#cb51-779" aria-hidden="true" tabindex="-1"></a>          <span class="fu">aes</span>(<span class="at">fill =</span> life_expectancy),</span>
<span id="cb51-780"><a href="#cb51-780" aria-hidden="true" tabindex="-1"></a>          <span class="at">linewidth =</span> <span class="fl">0.25</span>) <span class="sc">+</span></span>
<span id="cb51-781"><a href="#cb51-781" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf</span>(<span class="at">crs =</span> <span class="fu">st_crs</span>(<span class="st">"ESRI:54030"</span>)) <span class="sc">+</span>  <span class="co"># Robinson</span></span>
<span id="cb51-782"><a href="#cb51-782" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_c</span>(<span class="at">option =</span> <span class="st">"viridis"</span>) <span class="sc">+</span></span>
<span id="cb51-783"><a href="#cb51-783" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">fill =</span> <span class="st">"Life expectancy"</span>) <span class="sc">+</span></span>
<span id="cb51-784"><a href="#cb51-784" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb51-785"><a href="#cb51-785" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span>
<span id="cb51-786"><a href="#cb51-786" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
</code></pre></div><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></div>
</div></div></div></div></div>
</div> <!-- /content -->




</body></html>